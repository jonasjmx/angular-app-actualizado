{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/HP/Desktop/angular-app-actualizado/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Router } from '@angular/router';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nfunction LoginComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r0.errorMessage);\n  }\n}\nexport let LoginComponent = /*#__PURE__*/(() => {\n  class LoginComponent {\n    constructor(http, router) {\n      this.http = http;\n      this.router = router;\n      this.username = '';\n      this.password = '';\n      this.errorMessage = '';\n    }\n    onSubmit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.errorMessage = '';\n        if (!_this.username || !_this.password) {\n          _this.errorMessage = 'Por favor, ingrese usuario y contraseña.';\n          return;\n        }\n        try {\n          // 1. LOGIN\n          const resp = yield _this.http.post('https://localhost:7239/users/LoginAccessCount', {\n            email: _this.username,\n            password: _this.password\n          }, {\n            responseType: 'json'\n          }).toPromise();\n          const token = resp?.token || resp?.accessToken || resp?.Token || resp?.jwt || '';\n          if (!token || typeof token !== 'string' || token.length < 10) {\n            console.error('Respuesta de login completa:', resp);\n            _this.errorMessage = 'Token inválido recibido del servidor.';\n            return;\n          }\n          // Guarda token (y opcionalmente username)\n          localStorage.setItem('token', token);\n          localStorage.setItem('username', _this.username);\n          // 2. PERMISOS\n          const headers = new HttpHeaders({\n            Authorization: 'Bearer ' + token,\n            Accept: 'application/json'\n          });\n          let permisos = yield _this.http.get('https://localhost:7239/permissions/obtenerPermisos', {\n            headers\n          }).toPromise();\n          console.log('Permisos crudos recibidos:', permisos);\n          // Normalizar forma de permisos\n          if (!permisos) permisos = [];else if (Array.isArray(permisos)) permisos = permisos;else if (permisos.permisos && Array.isArray(permisos.permisos)) permisos = permisos.permisos;else if (permisos.data && Array.isArray(permisos.data)) permisos = permisos.data;else permisos = [];\n          console.log('Permisos normalizados:', permisos);\n          localStorage.setItem('permisos', JSON.stringify(permisos));\n          // 3. Ir al dashboard\n          _this.router.navigate(['/dashboard']);\n        } catch (err) {\n          console.error('Error en login o permisos:', err);\n          if (err?.status === 401) _this.errorMessage = 'Usuario o contraseña incorrectos.';else _this.errorMessage = 'No se pudo conectar con el servidor o cargar permisos.';\n        }\n      })();\n    }\n    static {\n      this.ɵfac = function LoginComponent_Factory(t) {\n        return new (t || LoginComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: LoginComponent,\n        selectors: [[\"app-login\"]],\n        decls: 22,\n        vars: 3,\n        consts: [[1, \"login-container\"], [1, \"left-section\"], [1, \"description\"], [\"src\", \"assets/images/carrito.png\", \"alt\", \"Compra\", 1, \"login-image\"], [1, \"right-section\"], [1, \"login-box\"], [1, \"login-form\", 3, \"ngSubmit\"], [1, \"input-group\"], [\"name\", \"username\", \"type\", \"text\", \"placeholder\", \"Usuario\", \"required\", \"\", \"autocomplete\", \"username\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"password\", \"type\", \"password\", \"placeholder\", \"Contrase\\u00F1a\", \"required\", \"\", \"autocomplete\", \"current-password\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"submit\", 1, \"login-btn\"], [\"class\", \"error-message\", 4, \"ngIf\"], [1, \"options\"], [\"href\", \"#\", 1, \"forgot-password\"], [1, \"error-message\"]],\n        template: function LoginComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\");\n            i0.ɵɵtext(3, \"Sistema de Ventas\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"p\", 2);\n            i0.ɵɵtext(5, \"Gestiona tus ventas de manera eficiente y profesional\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(6, \"img\", 3);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"div\", 4)(8, \"div\", 5)(9, \"h2\");\n            i0.ɵɵtext(10, \"Iniciar Sesi\\u00F3n\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(11, \"form\", 6);\n            i0.ɵɵlistener(\"ngSubmit\", function LoginComponent_Template_form_ngSubmit_11_listener() {\n              return ctx.onSubmit();\n            });\n            i0.ɵɵelementStart(12, \"div\", 7)(13, \"input\", 8);\n            i0.ɵɵlistener(\"ngModelChange\", function LoginComponent_Template_input_ngModelChange_13_listener($event) {\n              return ctx.username = $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(14, \"div\", 7)(15, \"input\", 9);\n            i0.ɵɵlistener(\"ngModelChange\", function LoginComponent_Template_input_ngModelChange_15_listener($event) {\n              return ctx.password = $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(16, \"button\", 10);\n            i0.ɵɵtext(17, \"Iniciar Sesi\\u00F3n\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(18, LoginComponent_div_18_Template, 2, 1, \"div\", 11);\n            i0.ɵɵelementStart(19, \"div\", 12)(20, \"a\", 13);\n            i0.ɵɵtext(21, \"\\u00BFOlvidaste tu contrase\\u00F1a?\");\n            i0.ɵɵelementEnd()()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(13);\n            i0.ɵɵproperty(\"ngModel\", ctx.username);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngModel\", ctx.password);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n          }\n        },\n        styles: [\"[_nghost-%COMP%]{display:block;min-height:100vh;box-sizing:border-box;padding:40px 24px;background:linear-gradient(90deg,#1f4f8b 0%,#2bb39a 100%);font-family:Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif}.login-container[_ngcontent-%COMP%]{display:flex;align-items:center;gap:60px;max-width:1200px;margin:0 auto}.left-section[_ngcontent-%COMP%]{flex:1;color:#fff;text-align:center;padding-left:40px}.left-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:56px;font-weight:800;margin:0 0 8px;text-shadow:0 2px 12px rgba(0,0,0,.12)}.description[_ngcontent-%COMP%]{color:#fffffff2;font-size:18px;line-height:1.6;margin:0 auto;max-width:520px}.login-image[_ngcontent-%COMP%]{margin-top:30px;max-width:360px;width:100%;height:auto;opacity:.95}.right-section[_ngcontent-%COMP%]{flex:0 0 420px}.login-box[_ngcontent-%COMP%]{background:#ffffff;border-radius:12px;padding:36px;box-shadow:0 18px 40px #0c23442e}h2[_ngcontent-%COMP%]{color:#1e3a8a;font-size:22px;font-weight:700;margin:0 0 18px;text-align:center}.login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:14px}.input-group[_ngcontent-%COMP%]{display:flex}input[type=text][_ngcontent-%COMP%], input[type=password][_ngcontent-%COMP%]{width:100%;padding:14px 16px;border:1px solid #ebedf2;border-radius:8px;background:#fbfdff;font-size:15px;color:#24303b;outline:none;box-shadow:inset 0 1px #fff9}input[_ngcontent-%COMP%]::placeholder{color:#b8c2cc}.login-btn[_ngcontent-%COMP%]{width:100%;padding:14px;background:linear-gradient(90deg,#233a8a 0%,#3b82f6 100%);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:700;cursor:pointer;box-shadow:0 8px 20px #3b82f647}.login-btn[_ngcontent-%COMP%]:active{transform:translateY(1px)}.error-message[_ngcontent-%COMP%]{background-color:#fff5f5;color:#b91c1c;padding:12px;border-radius:8px;font-size:14px;text-align:center;border:1px solid #fecaca;margin-top:8px}.options[_ngcontent-%COMP%]{margin-top:6px;text-align:center}.forgot-password[_ngcontent-%COMP%]{color:#2b6be6;font-size:14px;text-decoration:none}.forgot-password[_ngcontent-%COMP%]:hover{text-decoration:underline}@media (max-width: 900px){.login-container[_ngcontent-%COMP%]{flex-direction:column;gap:28px;padding-top:36px}.left-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:36px}.right-section[_ngcontent-%COMP%]{width:100%;max-width:480px}.left-section[_ngcontent-%COMP%]{padding-left:0}}\"]\n      });\n    }\n  }\n  return LoginComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}