{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/User/Desktop/angular-app/angular-app-recuperado/angular-app-actualizado/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { SalesService } from \"../services/sales.service\";\nimport { ProductService } from \"../services/product.service\";\nimport { CustomerService } from \"../services/customer.service\";\n// ðŸ‘‡ imports para PDF\nimport jsPDF from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/sales.service\";\nimport * as i2 from \"../services/product.service\";\nimport * as i3 from \"../services/customer.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nfunction SalesComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 4);\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate(ctx_r0.error);\n  }\n}\nfunction SalesComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 5);\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate(ctx_r1.success);\n  }\n}\nfunction SalesComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\");\n    i0.ÉµÉµtext(1, \"Cargando informaci\\u00F3n, por favor espere...\");\n    i0.ÉµÉµelementEnd();\n  }\n}\nfunction SalesComponent_div_6_option_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"option\", 13);\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const c_r9 = ctx.$implicit;\n    const ctx_r4 = i0.ÉµÉµnextContext(2);\n    i0.ÉµÉµproperty(\"value\", c_r9.id);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r4.getCustomerLabel(c_r9), \" \");\n  }\n}\nfunction SalesComponent_div_6_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"div\", 14)(1, \"div\");\n    i0.ÉµÉµtext(2, \"Total \\u00EDtems: \");\n    i0.ÉµÉµelementStart(3, \"strong\");\n    i0.ÉµÉµtext(4);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(5, \"button\", 15);\n    i0.ÉµÉµlistener(\"click\", function SalesComponent_div_6_div_9_Template_button_click_5_listener() {\n      i0.ÉµÉµrestoreView(_r11);\n      const ctx_r10 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r10.clearCart());\n    });\n    i0.ÉµÉµtext(6, \" Vaciar carrito \");\n    i0.ÉµÉµelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ÉµÉµnextContext(2);\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµtextInterpolate(ctx_r5.cartCount);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"disabled\", !ctx_r5.cartItems.length);\n  }\n}\nfunction SalesComponent_div_6_div_10_option_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"option\", 19);\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµpipe(2, \"number\");\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const p_r13 = ctx.$implicit;\n    i0.ÉµÉµproperty(\"ngValue\", p_r13.id);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate2(\" \", p_r13.name, \" - $\", i0.ÉµÉµpipeBind2(2, 3, p_r13.unitPrice, \"1.2-2\"), \" \");\n  }\n}\nfunction SalesComponent_div_6_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"div\", 16)(1, \"h2\");\n    i0.ÉµÉµtext(2, \"Agregar producto al carrito\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(3, \"div\", 17)(4, \"div\", 7)(5, \"label\");\n    i0.ÉµÉµtext(6, \"Producto\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(7, \"select\", 18);\n    i0.ÉµÉµlistener(\"ngModelChange\", function SalesComponent_div_6_div_10_Template_select_ngModelChange_7_listener($event) {\n      i0.ÉµÉµrestoreView(_r15);\n      const ctx_r14 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r14.selectedProductId = $event);\n    });\n    i0.ÉµÉµelementStart(8, \"option\", 19);\n    i0.ÉµÉµtext(9, \"-- Seleccione producto --\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtemplate(10, SalesComponent_div_6_div_10_option_10_Template, 3, 6, \"option\", 20);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(11, \"div\", 21)(12, \"label\");\n    i0.ÉµÉµtext(13, \"Cantidad\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(14, \"input\", 22);\n    i0.ÉµÉµlistener(\"ngModelChange\", function SalesComponent_div_6_div_10_Template_input_ngModelChange_14_listener($event) {\n      i0.ÉµÉµrestoreView(_r15);\n      const ctx_r16 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r16.newQuantity = $event);\n    });\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(15, \"div\", 7)(16, \"button\", 23);\n    i0.ÉµÉµlistener(\"click\", function SalesComponent_div_6_div_10_Template_button_click_16_listener() {\n      i0.ÉµÉµrestoreView(_r15);\n      const ctx_r17 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r17.addToCart());\n    });\n    i0.ÉµÉµtext(17, \"Agregar\");\n    i0.ÉµÉµelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.ÉµÉµnextContext(2);\n    i0.ÉµÉµadvance(7);\n    i0.ÉµÉµproperty(\"ngModel\", ctx_r6.selectedProductId);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngValue\", null);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµproperty(\"ngForOf\", ctx_r6.products);\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµproperty(\"ngModel\", ctx_r6.newQuantity);\n  }\n}\nfunction SalesComponent_div_6_div_11_table_3_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"tr\")(1, \"td\");\n    i0.ÉµÉµtext(2);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(3, \"td\");\n    i0.ÉµÉµtext(4);\n    i0.ÉµÉµpipe(5, \"number\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(6, \"td\")(7, \"input\", 28);\n    i0.ÉµÉµlistener(\"ngModelChange\", function SalesComponent_div_6_div_11_table_3_tr_14_Template_input_ngModelChange_7_listener($event) {\n      const restoredCtx = i0.ÉµÉµrestoreView(_r23);\n      const item_r21 = restoredCtx.$implicit;\n      return i0.ÉµÉµresetView(item_r21.quantity = $event);\n    })(\"ngModelChange\", function SalesComponent_div_6_div_11_table_3_tr_14_Template_input_ngModelChange_7_listener() {\n      const restoredCtx = i0.ÉµÉµrestoreView(_r23);\n      const item_r21 = restoredCtx.$implicit;\n      const ctx_r24 = i0.ÉµÉµnextContext(4);\n      return i0.ÉµÉµresetView(ctx_r24.onQuantityChanged(item_r21));\n    });\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(8, \"td\");\n    i0.ÉµÉµtext(9);\n    i0.ÉµÉµpipe(10, \"number\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(11, \"td\", 29)(12, \"button\", 30);\n    i0.ÉµÉµlistener(\"click\", function SalesComponent_div_6_div_11_table_3_tr_14_Template_button_click_12_listener() {\n      const restoredCtx = i0.ÉµÉµrestoreView(_r23);\n      const item_r21 = restoredCtx.$implicit;\n      const ctx_r25 = i0.ÉµÉµnextContext(4);\n      return i0.ÉµÉµresetView(ctx_r25.deleteItem(item_r21));\n    });\n    i0.ÉµÉµtext(13, \"\\uD83D\\uDDD1\\uFE0F\");\n    i0.ÉµÉµelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r21 = ctx.$implicit;\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(item_r21.productName);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate1(\"$\", i0.ÉµÉµpipeBind2(5, 5, item_r21.unitPrice, \"1.2-2\"), \"\");\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµpropertyInterpolate1(\"name\", \"qty_\", item_r21.productId, \"\");\n    i0.ÉµÉµproperty(\"ngModel\", item_r21.quantity);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate1(\"$\", i0.ÉµÉµpipeBind2(10, 8, item_r21.unitPrice * item_r21.quantity, \"1.2-2\"), \"\");\n  }\n}\nfunction SalesComponent_div_6_div_11_table_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"table\", 26)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ÉµÉµtext(4, \"Producto\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(5, \"th\");\n    i0.ÉµÉµtext(6, \"Precio unitario\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(7, \"th\");\n    i0.ÉµÉµtext(8, \"Cantidad\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(9, \"th\");\n    i0.ÉµÉµtext(10, \"Subtotal\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(11, \"th\");\n    i0.ÉµÉµtext(12, \"Acciones\");\n    i0.ÉµÉµelementEnd()()();\n    i0.ÉµÉµelementStart(13, \"tbody\");\n    i0.ÉµÉµtemplate(14, SalesComponent_div_6_div_11_table_3_tr_14_Template, 14, 11, \"tr\", 27);\n    i0.ÉµÉµelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r18 = i0.ÉµÉµnextContext(3);\n    i0.ÉµÉµadvance(14);\n    i0.ÉµÉµproperty(\"ngForOf\", ctx_r18.cartItems);\n  }\n}\nfunction SalesComponent_div_6_div_11_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 31)(1, \"div\", 32)(2, \"div\")(3, \"strong\");\n    i0.ÉµÉµtext(4, \"Subtotal:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(5);\n    i0.ÉµÉµpipe(6, \"number\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(7, \"div\")(8, \"strong\");\n    i0.ÉµÉµtext(9, \"IVA (15%):\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(10);\n    i0.ÉµÉµpipe(11, \"number\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(12, \"div\")(13, \"strong\");\n    i0.ÉµÉµtext(14, \"Total a pagar:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(15);\n    i0.ÉµÉµpipe(16, \"number\");\n    i0.ÉµÉµelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r19 = i0.ÉµÉµnextContext(3);\n    i0.ÉµÉµadvance(5);\n    i0.ÉµÉµtextInterpolate1(\" $\", i0.ÉµÉµpipeBind2(6, 3, ctx_r19.cartSubtotal, \"1.2-2\"), \"\");\n    i0.ÉµÉµadvance(5);\n    i0.ÉµÉµtextInterpolate1(\" $\", i0.ÉµÉµpipeBind2(11, 6, ctx_r19.cartIVA, \"1.2-2\"), \"\");\n    i0.ÉµÉµadvance(5);\n    i0.ÉµÉµtextInterpolate1(\" $\", i0.ÉµÉµpipeBind2(16, 9, ctx_r19.cartTotalPagar, \"1.2-2\"), \"\");\n  }\n}\nfunction SalesComponent_div_6_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 16)(1, \"h2\");\n    i0.ÉµÉµtext(2, \"Detalles del carrito\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtemplate(3, SalesComponent_div_6_div_11_table_3_Template, 15, 1, \"table\", 24);\n    i0.ÉµÉµtemplate(4, SalesComponent_div_6_div_11_div_4_Template, 17, 12, \"div\", 25);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ÉµÉµnextContext(2);\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµproperty(\"ngIf\", ctx_r7.cartItems && ctx_r7.cartItems.length);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngIf\", ctx_r7.cartItems.length);\n  }\n}\nfunction SalesComponent_div_6_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r27 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"div\", 16)(1, \"h2\");\n    i0.ÉµÉµtext(2, \"Crear orden\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(3, \"form\", 33);\n    i0.ÉµÉµlistener(\"ngSubmit\", function SalesComponent_div_6_div_12_Template_form_ngSubmit_3_listener() {\n      i0.ÉµÉµrestoreView(_r27);\n      const ctx_r26 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r26.createOrder());\n    });\n    i0.ÉµÉµelementStart(4, \"div\", 34)(5, \"div\", 7)(6, \"label\");\n    i0.ÉµÉµtext(7, \"Direcci\\u00F3n de env\\u00EDo\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(8, \"input\", 35);\n    i0.ÉµÉµlistener(\"ngModelChange\", function SalesComponent_div_6_div_12_Template_input_ngModelChange_8_listener($event) {\n      i0.ÉµÉµrestoreView(_r27);\n      const ctx_r28 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r28.shipAddress = $event);\n    });\n    i0.ÉµÉµelementEnd()()();\n    i0.ÉµÉµelementStart(9, \"div\", 34)(10, \"div\", 7)(11, \"label\");\n    i0.ÉµÉµtext(12, \"Ciudad\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(13, \"input\", 36);\n    i0.ÉµÉµlistener(\"ngModelChange\", function SalesComponent_div_6_div_12_Template_input_ngModelChange_13_listener($event) {\n      i0.ÉµÉµrestoreView(_r27);\n      const ctx_r29 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r29.shipCity = $event);\n    });\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(14, \"div\", 7)(15, \"label\");\n    i0.ÉµÉµtext(16, \"Pa\\u00EDs\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(17, \"input\", 37);\n    i0.ÉµÉµlistener(\"ngModelChange\", function SalesComponent_div_6_div_12_Template_input_ngModelChange_17_listener($event) {\n      i0.ÉµÉµrestoreView(_r27);\n      const ctx_r30 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r30.shipCountry = $event);\n    });\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(18, \"div\", 21)(19, \"label\");\n    i0.ÉµÉµtext(20, \"C\\u00F3digo Postal\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(21, \"input\", 38);\n    i0.ÉµÉµlistener(\"ngModelChange\", function SalesComponent_div_6_div_12_Template_input_ngModelChange_21_listener($event) {\n      i0.ÉµÉµrestoreView(_r27);\n      const ctx_r31 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r31.shipPostalCode = $event);\n    });\n    i0.ÉµÉµelementEnd()()();\n    i0.ÉµÉµelementStart(22, \"div\", 39)(23, \"button\", 40);\n    i0.ÉµÉµtext(24, \"Confirmar orden\");\n    i0.ÉµÉµelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r8 = i0.ÉµÉµnextContext(2);\n    i0.ÉµÉµadvance(8);\n    i0.ÉµÉµproperty(\"ngModel\", ctx_r8.shipAddress);\n    i0.ÉµÉµadvance(5);\n    i0.ÉµÉµproperty(\"ngModel\", ctx_r8.shipCity);\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµproperty(\"ngModel\", ctx_r8.shipCountry);\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµproperty(\"ngModel\", ctx_r8.shipPostalCode);\n  }\n}\nfunction SalesComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r33 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"div\")(1, \"div\", 6)(2, \"div\", 7)(3, \"label\");\n    i0.ÉµÉµtext(4, \"Cliente\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(5, \"select\", 8);\n    i0.ÉµÉµlistener(\"ngModelChange\", function SalesComponent_div_6_Template_select_ngModelChange_5_listener($event) {\n      i0.ÉµÉµrestoreView(_r33);\n      const ctx_r32 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r32.selectedCustomerId = $event);\n    })(\"change\", function SalesComponent_div_6_Template_select_change_5_listener() {\n      i0.ÉµÉµrestoreView(_r33);\n      const ctx_r34 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r34.onCustomerChange());\n    });\n    i0.ÉµÉµelementStart(6, \"option\", 9);\n    i0.ÉµÉµtext(7, \"-- Seleccione un cliente --\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtemplate(8, SalesComponent_div_6_option_8_Template, 2, 2, \"option\", 10);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµtemplate(9, SalesComponent_div_6_div_9_Template, 7, 2, \"div\", 11);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtemplate(10, SalesComponent_div_6_div_10_Template, 18, 4, \"div\", 12);\n    i0.ÉµÉµtemplate(11, SalesComponent_div_6_div_11_Template, 5, 2, \"div\", 12);\n    i0.ÉµÉµtemplate(12, SalesComponent_div_6_div_12_Template, 25, 4, \"div\", 12);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(5);\n    i0.ÉµÉµproperty(\"ngModel\", ctx_r3.selectedCustomerId);\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµproperty(\"ngForOf\", ctx_r3.customers);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngIf\", ctx_r3.selectedCustomerId);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngIf\", ctx_r3.selectedCustomerId);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngIf\", ctx_r3.selectedCustomerId);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµproperty(\"ngIf\", ctx_r3.selectedCustomerId && ctx_r3.cartItems.length);\n  }\n}\nexport let SalesComponent = /*#__PURE__*/(() => {\n  class SalesComponent {\n    constructor(salesSvc, prodSvc, customerSvc) {\n      this.salesSvc = salesSvc;\n      this.prodSvc = prodSvc;\n      this.customerSvc = customerSvc;\n      this.customers = [];\n      this.products = [];\n      this.selectedCustomerId = \"\";\n      this.cartItems = [];\n      this.cartCount = 0;\n      // Subtotales\n      this.cartSubtotal = 0;\n      this.cartIVA = 0;\n      this.cartTotalPagar = 0;\n      // formulario para agregar item\n      this.selectedProductId = null;\n      this.newQuantity = 1;\n      // formulario para crear orden\n      this.shipAddress = \"\";\n      this.shipCity = \"\";\n      this.shipCountry = \"\";\n      this.shipPostalCode = \"\";\n      this.loading = false;\n      this.error = \"\";\n      this.success = \"\";\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        yield _this.loadCustomersAndProducts();\n      })();\n    }\n    // ================== CLIENTES / PRODUCTOS ==================\n    loadCustomersAndProducts() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        _this2.loading = true;\n        _this2.error = \"\";\n        try {\n          const [customers, products] = yield Promise.all([_this2.customerSvc.getCustomers(), _this2.prodSvc.getProducts()]);\n          _this2.customers = customers || [];\n          _this2.products = products || [];\n          console.log(\"ðŸŸ¦ Clientes en Sales:\", _this2.customers);\n          _this2.loading = false;\n        } catch (err) {\n          console.error(\"Error cargando clientes/productos:\", err);\n          _this2.error = \"No se pudieron cargar clientes y productos\";\n          _this2.loading = false;\n        }\n      })();\n    }\n    /** Devuelve el cliente actualmente seleccionado */\n    getSelectedCustomer() {\n      return this.customers.find(c => c.id === this.selectedCustomerId);\n    }\n    /** Etiqueta bonita para mostrar en el combo de clientes */\n    getCustomerLabel(c) {\n      const fullName = `${c.firstName || \"\"} ${c.lastName || \"\"}`.trim();\n      if (fullName && c.cedula) return `${fullName} - ${c.cedula}`;\n      return fullName || c.cedula || c.id;\n    }\n    // ================== CARRITO ==================\n    onCustomerChange() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        _this3.success = \"\";\n        _this3.error = \"\";\n        if (!_this3.selectedCustomerId) {\n          _this3.cartItems = [];\n          _this3.cartCount = 0;\n          _this3.cartSubtotal = 0;\n          _this3.cartIVA = 0;\n          _this3.cartTotalPagar = 0;\n          return;\n        }\n        yield _this3.loadCart();\n      })();\n    }\n    /** ðŸ”„ Recalcula Subtotal, IVA, Total y nÃºmero de Ã­tems a partir de cartItems */\n    recalcTotals() {\n      this.cartSubtotal = this.cartItems.reduce((acc, it) => acc + (it.unitPrice || 0) * (it.quantity || 0), 0);\n      this.cartIVA = this.cartSubtotal * 0.15;\n      this.cartTotalPagar = this.cartSubtotal + this.cartIVA;\n      this.cartCount = this.cartItems.reduce((acc, it) => acc + (it.quantity || 0), 0);\n    }\n    /** Cuando cambia la cantidad en el input, recalculamos totales en vivo */\n    onQuantityChanged(item) {\n      // asegurar que quantity sea nÃºmero >= 1\n      const q = Number(item.quantity);\n      if (isNaN(q) || q <= 0) {\n        item.quantity = 1;\n      }\n      this.recalcTotals();\n    }\n    addToCart() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        _this4.success = \"\";\n        _this4.error = \"\";\n        if (!_this4.selectedCustomerId) {\n          _this4.error = \"Seleccione un cliente primero.\";\n          return;\n        }\n        if (!_this4.selectedProductId) {\n          _this4.error = \"Seleccione un producto.\";\n          return;\n        }\n        if (_this4.newQuantity <= 0) {\n          _this4.error = \"La cantidad debe ser mayor a 0.\";\n          return;\n        }\n        const prod = _this4.products.find(p => p.id === _this4.selectedProductId);\n        if (!prod) {\n          _this4.error = \"Producto no encontrado.\";\n          return;\n        }\n        const payload = {\n          productId: prod.id,\n          customerId: _this4.selectedCustomerId,\n          unitPrice: prod.unitPrice || 0,\n          quantity: _this4.newQuantity\n        };\n        try {\n          yield _this4.salesSvc.addCartDetail(payload);\n          _this4.success = \"Producto agregado al carrito.\";\n          _this4.newQuantity = 1;\n          yield _this4.loadCart();\n        } catch (err) {\n          console.error(\"Error al agregar al carrito:\", err);\n          _this4.error = \"No se pudo agregar el producto al carrito\";\n        }\n      })();\n    }\n    updateItem(item) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        _this5.success = \"\";\n        _this5.error = \"\";\n        if (!_this5.selectedCustomerId) return;\n        if (item.quantity <= 0) {\n          _this5.error = \"La cantidad debe ser mayor a 0.\";\n          return;\n        }\n        const payload = {\n          productId: item.productId,\n          customerId: _this5.selectedCustomerId,\n          unitPrice: item.unitPrice,\n          quantity: item.quantity\n        };\n        try {\n          yield _this5.salesSvc.updateCartDetail(payload);\n          _this5.success = \"Detalle actualizado.\";\n          // por si el backend toca algo (descuentos, etc.), recargamos\n          yield _this5.loadCart();\n        } catch (err) {\n          console.error(\"Error al actualizar detalle:\", err);\n          _this5.error = \"No se pudo actualizar el detalle.\";\n        }\n      })();\n    }\n    deleteItem(item) {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        _this6.success = \"\";\n        _this6.error = \"\";\n        if (!_this6.selectedCustomerId) return;\n        const ok = confirm(`Â¿Eliminar del carrito el producto \"${item.productName}\"?`);\n        if (!ok) return;\n        try {\n          yield _this6.salesSvc.deleteCartDetail(_this6.selectedCustomerId, item.productId);\n          _this6.success = \"Producto eliminado del carrito.\";\n          yield _this6.loadCart();\n        } catch (err) {\n          console.error(\"Error al eliminar detalle:\", err);\n          _this6.error = \"No se pudo eliminar el producto del carrito.\";\n        }\n      })();\n    }\n    clearCart() {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        _this7.success = \"\";\n        _this7.error = \"\";\n        if (!_this7.selectedCustomerId) return;\n        const ok = confirm(\"Â¿Vaciar todo el carrito de este cliente?\");\n        if (!ok) return;\n        try {\n          yield _this7.salesSvc.clearCartByCustomer(_this7.selectedCustomerId);\n          _this7.success = \"Carrito vaciado.\";\n          yield _this7.loadCart();\n        } catch (err) {\n          console.error(\"Error al limpiar carrito:\", err);\n          _this7.error = \"No se pudo limpiar el carrito.\";\n        }\n      })();\n    }\n    // ================== CREAR ORDEN + PDF ==================\n    createOrder() {\n      var _this8 = this;\n      return _asyncToGenerator(function* () {\n        _this8.success = \"\";\n        _this8.error = \"\";\n        if (!_this8.selectedCustomerId) {\n          _this8.error = \"Seleccione un cliente.\";\n          return;\n        }\n        if (!_this8.cartItems.length) {\n          _this8.error = \"El carrito estÃ¡ vacÃ­o.\";\n          return;\n        }\n        if (!_this8.shipAddress.trim() || !_this8.shipCity.trim() || !_this8.shipCountry.trim() || !_this8.shipPostalCode.trim()) {\n          _this8.error = \"Complete todos los datos de envÃ­o.\";\n          return;\n        }\n        const payload = {\n          customerId: _this8.selectedCustomerId,\n          shipAddress: _this8.shipAddress.trim(),\n          shipCity: _this8.shipCity.trim(),\n          shipCountry: _this8.shipCountry.trim(),\n          shipPostalCode: _this8.shipPostalCode.trim(),\n          orderDetails: _this8.cartItems.map(it => ({\n            productId: it.productId,\n            unitPrice: it.unitPrice,\n            quantity: it.quantity\n          }))\n        };\n        console.log(\"ðŸ“¦ Payload a /CreateOrder:\", JSON.stringify(payload, null, 2));\n        try {\n          const resp = yield _this8.salesSvc.createOrder(payload);\n          const invoiceNumber = resp?.orderId || resp?.id || new Date().getTime();\n          _this8.success = \"Orden creada correctamente.\";\n          _this8.generateInvoicePdf(invoiceNumber);\n          yield _this8.loadCart();\n        } catch (err) {\n          console.error(\"Error al crear orden:\", err);\n          if (err?.error) {\n            console.log(\"Detalle del error del backend:\", err.error);\n            console.log(\"Detalle JSON:\", JSON.stringify(err.error, null, 2));\n          }\n          const backend = err?.error;\n          const detail = backend?.detail;\n          const modelErrors = backend?.errors;\n          if (detail) {\n            _this8.error = detail;\n          } else if (modelErrors) {\n            const mensajes = [];\n            for (const key of Object.keys(modelErrors)) {\n              const arr = modelErrors[key];\n              if (Array.isArray(arr)) {\n                mensajes.push(`${key}: ${arr.join(\", \")}`);\n              }\n            }\n            _this8.error = mensajes.join(\" | \") || \"Error en los datos de la orden.\";\n          } else if (backend?.title) {\n            _this8.error = backend.title;\n          } else {\n            _this8.error = \"No se pudo crear la orden (400). Revisa la consola para mÃ¡s detalles.\";\n          }\n        }\n      })();\n    }\n    // ================== GENERAR PDF ==================\n    generateInvoicePdf(invoiceNumber) {\n      const doc = new jsPDF();\n      const fecha = new Date().toLocaleString();\n      const customer = this.getSelectedCustomer();\n      const fullName = customer ? `${customer.firstName || \"\"} ${customer.lastName || \"\"}`.trim() : this.selectedCustomerId;\n      const cedula = customer?.cedula || \"\";\n      const email = customer?.email || \"\";\n      const phone = customer?.phoneNumber || \"\";\n      // ============= ENCABEZADO =============\n      doc.setFillColor(30, 64, 175);\n      doc.rect(0, 0, 210, 25, \"F\");\n      doc.setFontSize(18);\n      doc.setTextColor(255, 255, 255);\n      doc.text(\"Northwind Sales\", 14, 16);\n      doc.setFontSize(11);\n      doc.setTextColor(255, 255, 255);\n      doc.text(`Factura NÂ°: ${invoiceNumber}`, 210 - 14, 10, {\n        align: \"right\"\n      });\n      doc.text(`Fecha: ${fecha}`, 210 - 14, 16, {\n        align: \"right\"\n      });\n      doc.setFontSize(16);\n      doc.setTextColor(40, 40, 40);\n      doc.text(\"FACTURA DE VENTA\", 105, 35, {\n        align: \"center\"\n      });\n      // ============= DATOS CLIENTE / ENVÃO =============\n      const boxStartY = 42;\n      doc.setDrawColor(200, 200, 200);\n      doc.setLineWidth(0.3);\n      doc.roundedRect(14, boxStartY, 90, 50, 2, 2);\n      doc.setFontSize(11);\n      doc.setTextColor(80, 80, 80);\n      doc.text(\"Datos del Cliente\", 16, boxStartY + 6);\n      doc.setFontSize(10);\n      let y = boxStartY + 14;\n      doc.text(`Cliente: ${fullName}`, 16, y);\n      if (cedula) {\n        y += 6;\n        doc.text(`CÃ©dula: ${cedula}`, 16, y);\n      }\n      if (email) {\n        y += 6;\n        doc.text(`Email: ${email}`, 16, y);\n      }\n      if (phone) {\n        y += 6;\n        doc.text(`TelÃ©fono: ${phone}`, 16, y);\n      }\n      doc.roundedRect(110, boxStartY, 86, 40, 2, 2);\n      doc.setFontSize(11);\n      doc.text(\"Datos de EnvÃ­o\", 112, boxStartY + 6);\n      doc.setFontSize(10);\n      doc.text(`DirecciÃ³n: ${this.shipAddress}`, 112, boxStartY + 14);\n      doc.text(`Ciudad: ${this.shipCity}`, 112, boxStartY + 20);\n      doc.text(`PaÃ­s: ${this.shipCountry}`, 112, boxStartY + 26);\n      doc.text(`CÃ³d. Postal: ${this.shipPostalCode}`, 112, boxStartY + 32);\n      // ============= TABLA DE DETALLES =============\n      const body = this.cartItems.map(it => [it.productName, it.quantity, `$ ${(it.unitPrice || 0).toFixed(2)}`, `$ ${((it.unitPrice || 0) * (it.quantity || 0)).toFixed(2)}`]);\n      autoTable(doc, {\n        startY: boxStartY + 55,\n        head: [[\"Producto\", \"Cant.\", \"Precio Unit.\", \"Subtotal\"]],\n        body,\n        styles: {\n          fontSize: 10,\n          cellPadding: 3\n        },\n        headStyles: {\n          fillColor: [30, 64, 175],\n          textColor: 255,\n          halign: \"center\"\n        },\n        alternateRowStyles: {\n          fillColor: [245, 248, 255]\n        },\n        columnStyles: {\n          1: {\n            halign: \"center\",\n            cellWidth: 20\n          },\n          2: {\n            halign: \"right\",\n            cellWidth: 30\n          },\n          3: {\n            halign: \"right\",\n            cellWidth: 30\n          }\n        }\n      });\n      // ============= RESUMEN DE TOTALES =============\n      const finalY = doc.lastAutoTable?.finalY || 100;\n      const resumenX = 120;\n      const resumenW = 76;\n      const resumenH = 30;\n      doc.setDrawColor(200, 200, 200);\n      doc.roundedRect(resumenX, finalY + 6, resumenW, resumenH, 2, 2);\n      doc.setFontSize(11);\n      doc.setTextColor(60, 60, 60);\n      const line1Y = finalY + 14;\n      const line2Y = finalY + 20;\n      const line3Y = finalY + 26;\n      doc.text(\"Subtotal:\", resumenX + 4, line1Y);\n      doc.text(\"IVA (15%):\", resumenX + 4, line2Y);\n      doc.text(\"TOTAL:\", resumenX + 4, line3Y);\n      doc.setFontSize(11);\n      doc.setTextColor(0, 0, 0);\n      doc.text(`$ ${this.cartSubtotal.toFixed(2)}`, resumenX + resumenW - 4, line1Y, {\n        align: \"right\"\n      });\n      doc.text(`$ ${this.cartIVA.toFixed(2)}`, resumenX + resumenW - 4, line2Y, {\n        align: \"right\"\n      });\n      doc.setFontSize(12);\n      doc.setTextColor(30, 64, 175);\n      doc.text(`$ ${this.cartTotalPagar.toFixed(2)}`, resumenX + resumenW - 4, line3Y, {\n        align: \"right\"\n      });\n      doc.setFontSize(9);\n      doc.setTextColor(130, 130, 130);\n      doc.text(\"Gracias por su compra.\", 14, 290);\n      doc.text(\"Northwind Sales - Sistema de Ventas\", 210 - 14, 290, {\n        align: \"right\"\n      });\n      doc.save(`factura_${invoiceNumber}.pdf`);\n    }\n    static {\n      this.Éµfac = function SalesComponent_Factory(t) {\n        return new (t || SalesComponent)(i0.ÉµÉµdirectiveInject(i1.SalesService), i0.ÉµÉµdirectiveInject(i2.ProductService), i0.ÉµÉµdirectiveInject(i3.CustomerService));\n      };\n    }\n    static {\n      this.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n        type: SalesComponent,\n        selectors: [[\"app-sales\"]],\n        decls: 7,\n        vars: 4,\n        consts: [[1, \"sales-wrapper\"], [\"class\", \"alert alert-error\", 4, \"ngIf\"], [\"class\", \"alert alert-success\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"alert\", \"alert-error\"], [1, \"alert\", \"alert-success\"], [1, \"filters-row\"], [1, \"field\"], [\"name\", \"customerSelect\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"summary-box\", 4, \"ngIf\"], [\"class\", \"card\", 4, \"ngIf\"], [3, \"value\"], [1, \"summary-box\"], [1, \"btn-secondary\", 3, \"disabled\", \"click\"], [1, \"card\"], [1, \"add-row\"], [\"name\", \"productSelect\", 3, \"ngModel\", \"ngModelChange\"], [3, \"ngValue\"], [3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [1, \"field\", \"small\"], [\"type\", \"number\", \"name\", \"quantity\", \"min\", \"1\", 3, \"ngModel\", \"ngModelChange\"], [1, \"btn-primary\", 3, \"click\"], [\"class\", \"cart-table\", 4, \"ngIf\"], [\"class\", \"totals-container\", 4, \"ngIf\"], [1, \"cart-table\"], [4, \"ngFor\", \"ngForOf\"], [\"type\", \"number\", \"min\", \"1\", 3, \"ngModel\", \"name\", \"ngModelChange\"], [1, \"actions-cell\"], [1, \"icon-btn\", \"delete\", 3, \"click\"], [1, \"totals-container\"], [1, \"totals-box\"], [1, \"order-form\", 3, \"ngSubmit\"], [1, \"row\"], [\"type\", \"text\", \"name\", \"shipAddress\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"text\", \"name\", \"shipCity\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"text\", \"name\", \"shipCountry\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"text\", \"name\", \"shipPostalCode\", 3, \"ngModel\", \"ngModelChange\"], [1, \"buttons-row\"], [\"type\", \"submit\", 1, \"btn-primary\"]],\n        template: function SalesComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ÉµÉµelementStart(0, \"div\", 0)(1, \"h1\");\n            i0.ÉµÉµtext(2, \"Gesti\\u00F3n de Ventas\");\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµtemplate(3, SalesComponent_div_3_Template, 2, 1, \"div\", 1);\n            i0.ÉµÉµtemplate(4, SalesComponent_div_4_Template, 2, 1, \"div\", 2);\n            i0.ÉµÉµtemplate(5, SalesComponent_div_5_Template, 2, 0, \"div\", 3);\n            i0.ÉµÉµtemplate(6, SalesComponent_div_6_Template, 13, 6, \"div\", 3);\n            i0.ÉµÉµelementEnd();\n          }\n          if (rf & 2) {\n            i0.ÉµÉµadvance(3);\n            i0.ÉµÉµproperty(\"ngIf\", ctx.error);\n            i0.ÉµÉµadvance(1);\n            i0.ÉµÉµproperty(\"ngIf\", ctx.success);\n            i0.ÉµÉµadvance(1);\n            i0.ÉµÉµproperty(\"ngIf\", ctx.loading);\n            i0.ÉµÉµadvance(1);\n            i0.ÉµÉµproperty(\"ngIf\", !ctx.loading);\n          }\n        },\n        dependencies: [i4.NgForOf, i4.NgIf, i5.ÉµNgNoValidate, i5.NgSelectOption, i5.ÉµNgSelectMultipleOption, i5.DefaultValueAccessor, i5.NumberValueAccessor, i5.SelectControlValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.MinValidator, i5.NgModel, i5.NgForm, i4.DecimalPipe],\n        styles: [\".sales-wrapper[_ngcontent-%COMP%]{width:100%;font-family:Arial,sans-serif}.sales-wrapper[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:12px;color:#164e63}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;margin-bottom:8px;color:#0f172a}.alert[_ngcontent-%COMP%]{padding:10px 12px;border-radius:6px;margin-bottom:10px;font-size:14px}.alert-error[_ngcontent-%COMP%]{background:#fee2e2;color:#b91c1c;border:1px solid #fecaca}.alert-success[_ngcontent-%COMP%]{background:#dcfce7;color:#166534;border:1px solid #bbf7d0}.filters-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:16px;margin-bottom:12px}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:4px}.field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:6px 8px;border-radius:4px;border:1px solid #cbd5e1;min-width:180px}.field.small[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .field.small[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:80px}.summary-box[_ngcontent-%COMP%]{background:#f1f5f9;border-radius:8px;padding:8px 12px;display:flex;align-items:center;gap:16px}.card[_ngcontent-%COMP%]{background:#ffffff;border-radius:8px;border:1px solid #e2e8f0;padding:12px 14px;margin-top:12px}.cart-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:8px}.cart-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .cart-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e5e7eb;padding:8px 10px;text-align:left}.cart-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f9fafb}.btn-primary[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;border:none;padding:7px 12px;border-radius:6px;cursor:pointer;font-weight:700}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.btn-secondary[_ngcontent-%COMP%]{background-color:#64748b;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#475569}.action-btn-edit[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;border:none;padding:5px 10px;border-radius:4px;margin-right:4px;cursor:pointer}.action-btn-edit[_ngcontent-%COMP%]:hover{background-color:#2c82c9}.action-btn-delete[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff;border:none;padding:5px 10px;border-radius:4px;cursor:pointer}.action-btn-delete[_ngcontent-%COMP%]:hover{background-color:#c0392b}.add-row[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:flex-end}.order-form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:8px}.buttons-row[_ngcontent-%COMP%]{margin-top:10px}.totals-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;width:100%;margin-top:15px}.totals-box[_ngcontent-%COMP%]{padding:14px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;min-width:260px;max-width:300px;font-size:15px;line-height:1.7;box-shadow:0 2px 6px #0000000f}.totals-box[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:4px}.totals-box[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{font-size:17px;font-weight:700}.actions-cell[_ngcontent-%COMP%]{display:flex;gap:8px}.icon-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;cursor:pointer;border:none;font-size:18px;display:flex;align-items:center;justify-content:center;transition:.2s ease}.icon-btn.edit[_ngcontent-%COMP%]{background:#3498db;color:#fff}.icon-btn.delete[_ngcontent-%COMP%]{background:#e74c3c;color:#fff}.icon-btn[_ngcontent-%COMP%]:hover{transform:scale(1.1);filter:brightness(1.15)}.icon-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}\"]\n      });\n    }\n  }\n  return SalesComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}