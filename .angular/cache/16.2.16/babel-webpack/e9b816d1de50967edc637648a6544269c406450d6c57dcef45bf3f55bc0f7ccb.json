{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/User/Desktop/angular-app/angular-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { ApiService } from '../services/api.service';\nimport { Router } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"../services/api.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../products/products.component\";\nfunction DashboardComponent_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13)(1, \"h1\");\n    i0.ɵɵtext(2, \"Bienvenido, Administrador\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"Selecciona una opci\\u00F3n del men\\u00FA para comenzar.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction DashboardComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"h1\");\n    i0.ɵɵtext(2, \"Gesti\\u00F3n de Usuarios\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"Gestiona usuarios y roles aqu\\u00ED.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction DashboardComponent_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"h1\");\n    i0.ɵɵtext(2, \"Gesti\\u00F3n de Ventas\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"Consulta y administra pedidos.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction DashboardComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵelement(1, \"app-products\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction DashboardComponent_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"h1\");\n    i0.ɵɵtext(2, \"Gesti\\u00F3n de Permisos\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"Configura permisos y accesos.\");\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let DashboardComponent = /*#__PURE__*/(() => {\n  class DashboardComponent {\n    constructor(router, api) {\n      this.router = router;\n      this.api = api;\n      this.selectedSection = 'inicio';\n      this.permisos = [];\n      this.notAuthorized = false;\n      this.isAdmin = false;\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const token = localStorage.getItem('token');\n        // Si no hay token, redirigimos al login\n        if (!token) {\n          console.warn('Dashboard: no token encontrado, redirigiendo a login.');\n          localStorage.removeItem('token');\n          localStorage.removeItem('permisos');\n          _this.router.navigate(['/login']);\n          return;\n        }\n        // 1) Cargar permisos desde localStorage\n        let permisos = null;\n        try {\n          permisos = JSON.parse(localStorage.getItem('permisos') || 'null');\n        } catch {\n          permisos = null;\n        }\n        // Normalizar permisos leídos\n        if (!permisos) {\n          permisos = [];\n        } else if (!Array.isArray(permisos)) {\n          if (permisos.permisos && Array.isArray(permisos.permisos)) {\n            permisos = permisos.permisos;\n          } else if (permisos.data && Array.isArray(permisos.data)) {\n            permisos = permisos.data;\n          } else {\n            permisos = [];\n          }\n        }\n        // 2) Si no hay permisos en localStorage, tratamos de pedirlos al backend\n        if (permisos.length === 0) {\n          try {\n            const fetched = yield _this.api.get('https://localhost:7239/permissions/obtenerPermisos');\n            if (fetched) {\n              if (Array.isArray(fetched)) {\n                permisos = fetched;\n              } else if (fetched.permisos && Array.isArray(fetched.permisos)) {\n                permisos = fetched.permisos;\n              } else if (fetched.data && Array.isArray(fetched.data)) {\n                permisos = fetched.data;\n              } else {\n                permisos = [];\n              }\n              // Guardar de nuevo en localStorage\n              localStorage.setItem('permisos', JSON.stringify(permisos || []));\n            }\n          } catch (err) {\n            console.warn('Dashboard: no se pudieron obtener permisos del servidor.', err);\n          }\n        }\n        // 3) Regla de admin: debe tener exactamente 63 permisos\n        _this.isAdmin = Array.isArray(permisos) && permisos.length === 63;\n        _this.notAuthorized = !_this.isAdmin;\n        _this.permisos = permisos || [];\n        console.log('Dashboard → permisos cargados:', _this.permisos.length, '→ esAdmin:', _this.isAdmin);\n      })();\n    }\n    // Cambiar sección del dashboard (ya lo usas en tu HTML)\n    selectSection(id) {\n      this.selectedSection = id;\n    }\n    // Cerrar sesión\n    logout() {\n      localStorage.removeItem('token');\n      localStorage.removeItem('permisos');\n      this.router.navigate(['/login']);\n    }\n    // (Opcional) Helper por si luego quieres usar permisos específicos en el HTML\n    hasPermission(name) {\n      return this.permisos.some(p => p && p.name === name);\n    }\n    static {\n      this.ɵfac = function DashboardComponent_Factory(t) {\n        return new (t || DashboardComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.ApiService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: DashboardComponent,\n        selectors: [[\"app-dashboard\"]],\n        decls: 31,\n        vars: 15,\n        consts: [[1, \"dashboard-container\"], [1, \"sidebar\"], [1, \"menu-title\"], [1, \"menu-list\"], [1, \"menu-item\", 3, \"click\"], [1, \"fa-solid\", \"fa-house\", \"icon\"], [1, \"fa-solid\", \"fa-user\", \"icon\"], [1, \"fa-solid\", \"fa-file-invoice\", \"icon\"], [1, \"fa-solid\", \"fa-box\", \"icon\"], [1, \"fa-solid\", \"fa-lock\", \"icon\"], [1, \"content\"], [\"class\", \"section visible\", 4, \"ngIf\"], [\"class\", \"section\", 4, \"ngIf\"], [1, \"section\", \"visible\"], [1, \"section\"]],\n        template: function DashboardComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"aside\", 1)(2, \"h3\", 2);\n            i0.ɵɵtext(3, \"Men\\u00FA\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"ul\", 3)(5, \"li\", 4);\n            i0.ɵɵlistener(\"click\", function DashboardComponent_Template_li_click_5_listener() {\n              return ctx.selectSection(\"inicio\");\n            });\n            i0.ɵɵelement(6, \"i\", 5);\n            i0.ɵɵelementStart(7, \"span\");\n            i0.ɵɵtext(8, \"Inicio\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(9, \"li\", 4);\n            i0.ɵɵlistener(\"click\", function DashboardComponent_Template_li_click_9_listener() {\n              return ctx.selectSection(\"usuarios\");\n            });\n            i0.ɵɵelement(10, \"i\", 6);\n            i0.ɵɵelementStart(11, \"span\");\n            i0.ɵɵtext(12, \"Usuarios\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(13, \"li\", 4);\n            i0.ɵɵlistener(\"click\", function DashboardComponent_Template_li_click_13_listener() {\n              return ctx.selectSection(\"ventas\");\n            });\n            i0.ɵɵelement(14, \"i\", 7);\n            i0.ɵɵelementStart(15, \"span\");\n            i0.ɵɵtext(16, \"Ventas\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(17, \"li\", 4);\n            i0.ɵɵlistener(\"click\", function DashboardComponent_Template_li_click_17_listener() {\n              return ctx.selectSection(\"productos\");\n            });\n            i0.ɵɵelement(18, \"i\", 8);\n            i0.ɵɵelementStart(19, \"span\");\n            i0.ɵɵtext(20, \"Productos\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(21, \"li\", 4);\n            i0.ɵɵlistener(\"click\", function DashboardComponent_Template_li_click_21_listener() {\n              return ctx.selectSection(\"permisos\");\n            });\n            i0.ɵɵelement(22, \"i\", 9);\n            i0.ɵɵelementStart(23, \"span\");\n            i0.ɵɵtext(24, \"Permisos\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(25, \"main\", 10);\n            i0.ɵɵtemplate(26, DashboardComponent_div_26_Template, 5, 0, \"div\", 11);\n            i0.ɵɵtemplate(27, DashboardComponent_div_27_Template, 5, 0, \"div\", 12);\n            i0.ɵɵtemplate(28, DashboardComponent_div_28_Template, 5, 0, \"div\", 12);\n            i0.ɵɵtemplate(29, DashboardComponent_div_29_Template, 2, 0, \"div\", 12);\n            i0.ɵɵtemplate(30, DashboardComponent_div_30_Template, 5, 0, \"div\", 12);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(5);\n            i0.ɵɵclassProp(\"active\", ctx.selectedSection === \"inicio\");\n            i0.ɵɵadvance(4);\n            i0.ɵɵclassProp(\"active\", ctx.selectedSection === \"usuarios\");\n            i0.ɵɵadvance(4);\n            i0.ɵɵclassProp(\"active\", ctx.selectedSection === \"ventas\");\n            i0.ɵɵadvance(4);\n            i0.ɵɵclassProp(\"active\", ctx.selectedSection === \"productos\");\n            i0.ɵɵadvance(4);\n            i0.ɵɵclassProp(\"active\", ctx.selectedSection === \"permisos\");\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedSection === \"inicio\");\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedSection === \"usuarios\");\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedSection === \"ventas\");\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedSection === \"productos\");\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.selectedSection === \"permisos\");\n          }\n        },\n        dependencies: [i3.NgIf, i4.ProductsComponent],\n        styles: [\"var[_ngcontent-%COMP%]   resource[_ngcontent-%COMP%]; (()[_ngcontent-%COMP%]   =[_ngcontent-%COMP%] >  {// webpackBootstrap var __webpack_modules__ = ({589: (() => {throw new Error(\\\"Module build failed (from ./node_modules/postcss-loader/dist/cjs.js):nnSyntaxErrornn(13:1) C:\\\\\\\\Users\\\\\\\\User\\\\\\\\Desktop\\\\\\\\angular-app\\\\\\\\angular-app\\\\\\\\src\\\\\\\\app\\\\\\\\dashboard\\\\\\\\dashboard.component.css Unclosed blocknn u001b[90m 11 | u001b[39mu001b[33m.contentu001b[39m u001b[33m{u001b[39m flexu001b[33m:u001b[39m 1u001b[33m;u001b[39m paddingu001b[33m:u001b[39m 2remu001b[33m;u001b[39m backgroundu001b[33m:u001b[39m whiteu001b[33m;u001b[39m overflow-yu001b[33m:u001b[39m autou001b[33m;u001b[39m border-top-left-radiusu001b[33m:u001b[39m 12pxu001b[33m;u001b[39m box-shadowu001b[33m:u001b[39m -5px 0 12px u001b[36mrgbau001b[39mu001b[36m(0,0,0,0.15)u001b[39mu001b[33m;u001b[39m u001b[33m}u001b[39mn u001b[90m 12 | u001b[39mu001b[33m.sectionu001b[39m u001b[33m{u001b[39m u001b[90m\\nu001b[39mu001b[33m}u001b[39mnu001b[1mu001b[31m>u001b[39mu001b[22mu001b[90m 13 | u001b[39mu001b[33m.section.visibleu001b[39m u001b[33m{u001b[39m u001b[90m/*display: block; }u001b[39mn u001b[90m    | u001b[39mu001b[1mu001b[31m^u001b[39mu001b[22mn u001b[90m 14 | u001b[39mu001b[90mh1 { color: #236fa2; }u001b[39mn u001b[90m 15 | u001b[39mu001b[90mu001b[39mn\\\");})}); // startup // Load entry module and return exports // This entry module doesn\\\"t tell about it\\\"s top-level declarations so it can't be inlined\\nvar __webpack_exports__ = {}; __webpack_modules__[589](); resource = __webpack_exports__;})()[_ngcontent-%COMP%]   ;[_ngcontent-%COMP%]{}\"]\n      });\n    }\n  }\n  return DashboardComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}