{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/User/Desktop/angular-app/angular-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { SalesService } from '../services/sales.service';\nimport { ProductService } from '../services/product.service';\nimport { CustomerService } from '../services/customer.service';\n// üëá imports para PDF\nimport jsPDF from 'jspdf';\nimport autoTable from 'jspdf-autotable';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/sales.service\";\nimport * as i2 from \"../services/product.service\";\nimport * as i3 from \"../services/customer.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nfunction SalesComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.…µ…µelementStart(0, \"div\", 4);\n    i0.…µ…µtext(1);\n    i0.…µ…µelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.…µ…µnextContext();\n    i0.…µ…µadvance(1);\n    i0.…µ…µtextInterpolate(ctx_r0.error);\n  }\n}\nfunction SalesComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.…µ…µelementStart(0, \"div\", 5);\n    i0.…µ…µtext(1);\n    i0.…µ…µelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.…µ…µnextContext();\n    i0.…µ…µadvance(1);\n    i0.…µ…µtextInterpolate(ctx_r1.success);\n  }\n}\nfunction SalesComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.…µ…µelementStart(0, \"div\");\n    i0.…µ…µtext(1, \"Cargando informaci\\u00F3n, por favor espere...\");\n    i0.…µ…µelementEnd();\n  }\n}\nfunction SalesComponent_div_6_option_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.…µ…µelementStart(0, \"option\", 13);\n    i0.…µ…µtext(1);\n    i0.…µ…µelementEnd();\n  }\n  if (rf & 2) {\n    const c_r9 = ctx.$implicit;\n    i0.…µ…µproperty(\"value\", c_r9.id);\n    i0.…µ…µadvance(1);\n    i0.…µ…µtextInterpolate1(\" \", c_r9.name, \" \");\n  }\n}\nfunction SalesComponent_div_6_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.…µ…µgetCurrentView();\n    i0.…µ…µelementStart(0, \"div\", 14)(1, \"div\");\n    i0.…µ…µtext(2, \"Total \\u00EDtems: \");\n    i0.…µ…µelementStart(3, \"strong\");\n    i0.…µ…µtext(4);\n    i0.…µ…µelementEnd()();\n    i0.…µ…µelementStart(5, \"button\", 15);\n    i0.…µ…µlistener(\"click\", function SalesComponent_div_6_div_9_Template_button_click_5_listener() {\n      i0.…µ…µrestoreView(_r11);\n      const ctx_r10 = i0.…µ…µnextContext(2);\n      return i0.…µ…µresetView(ctx_r10.clearCart());\n    });\n    i0.…µ…µtext(6, \" Vaciar carrito \");\n    i0.…µ…µelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.…µ…µnextContext(2);\n    i0.…µ…µadvance(4);\n    i0.…µ…µtextInterpolate(ctx_r5.cartCount);\n    i0.…µ…µadvance(1);\n    i0.…µ…µproperty(\"disabled\", !ctx_r5.cartItems.length);\n  }\n}\nfunction SalesComponent_div_6_div_10_option_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.…µ…µelementStart(0, \"option\", 19);\n    i0.…µ…µtext(1);\n    i0.…µ…µpipe(2, \"number\");\n    i0.…µ…µelementEnd();\n  }\n  if (rf & 2) {\n    const p_r13 = ctx.$implicit;\n    i0.…µ…µproperty(\"ngValue\", p_r13.id);\n    i0.…µ…µadvance(1);\n    i0.…µ…µtextInterpolate2(\" \", p_r13.name, \" - $\", i0.…µ…µpipeBind2(2, 3, p_r13.unitPrice, \"1.2-2\"), \" \");\n  }\n}\nfunction SalesComponent_div_6_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.…µ…µgetCurrentView();\n    i0.…µ…µelementStart(0, \"div\", 16)(1, \"h2\");\n    i0.…µ…µtext(2, \"Agregar producto al carrito\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(3, \"div\", 17)(4, \"div\", 7)(5, \"label\");\n    i0.…µ…µtext(6, \"Producto\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(7, \"select\", 18);\n    i0.…µ…µlistener(\"ngModelChange\", function SalesComponent_div_6_div_10_Template_select_ngModelChange_7_listener($event) {\n      i0.…µ…µrestoreView(_r15);\n      const ctx_r14 = i0.…µ…µnextContext(2);\n      return i0.…µ…µresetView(ctx_r14.selectedProductId = $event);\n    });\n    i0.…µ…µelementStart(8, \"option\", 19);\n    i0.…µ…µtext(9, \"-- Seleccione producto --\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µtemplate(10, SalesComponent_div_6_div_10_option_10_Template, 3, 6, \"option\", 20);\n    i0.…µ…µelementEnd()();\n    i0.…µ…µelementStart(11, \"div\", 21)(12, \"label\");\n    i0.…µ…µtext(13, \"Cantidad\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(14, \"input\", 22);\n    i0.…µ…µlistener(\"ngModelChange\", function SalesComponent_div_6_div_10_Template_input_ngModelChange_14_listener($event) {\n      i0.…µ…µrestoreView(_r15);\n      const ctx_r16 = i0.…µ…µnextContext(2);\n      return i0.…µ…µresetView(ctx_r16.newQuantity = $event);\n    });\n    i0.…µ…µelementEnd()();\n    i0.…µ…µelementStart(15, \"div\", 7)(16, \"button\", 23);\n    i0.…µ…µlistener(\"click\", function SalesComponent_div_6_div_10_Template_button_click_16_listener() {\n      i0.…µ…µrestoreView(_r15);\n      const ctx_r17 = i0.…µ…µnextContext(2);\n      return i0.…µ…µresetView(ctx_r17.addToCart());\n    });\n    i0.…µ…µtext(17, \"Agregar\");\n    i0.…µ…µelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r6 = i0.…µ…µnextContext(2);\n    i0.…µ…µadvance(7);\n    i0.…µ…µproperty(\"ngModel\", ctx_r6.selectedProductId);\n    i0.…µ…µadvance(1);\n    i0.…µ…µproperty(\"ngValue\", null);\n    i0.…µ…µadvance(2);\n    i0.…µ…µproperty(\"ngForOf\", ctx_r6.products);\n    i0.…µ…µadvance(4);\n    i0.…µ…µproperty(\"ngModel\", ctx_r6.newQuantity);\n  }\n}\nfunction SalesComponent_div_6_div_11_table_3_tr_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.…µ…µgetCurrentView();\n    i0.…µ…µelementStart(0, \"tr\")(1, \"td\");\n    i0.…µ…µtext(2);\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(3, \"td\");\n    i0.…µ…µtext(4);\n    i0.…µ…µpipe(5, \"number\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(6, \"td\")(7, \"input\", 28);\n    i0.…µ…µlistener(\"ngModelChange\", function SalesComponent_div_6_div_11_table_3_tr_14_Template_input_ngModelChange_7_listener($event) {\n      const restoredCtx = i0.…µ…µrestoreView(_r23);\n      const item_r21 = restoredCtx.$implicit;\n      return i0.…µ…µresetView(item_r21.quantity = $event);\n    });\n    i0.…µ…µelementEnd()();\n    i0.…µ…µelementStart(8, \"td\");\n    i0.…µ…µtext(9);\n    i0.…µ…µpipe(10, \"number\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(11, \"td\", 29)(12, \"button\", 30);\n    i0.…µ…µlistener(\"click\", function SalesComponent_div_6_div_11_table_3_tr_14_Template_button_click_12_listener() {\n      const restoredCtx = i0.…µ…µrestoreView(_r23);\n      const item_r21 = restoredCtx.$implicit;\n      const ctx_r24 = i0.…µ…µnextContext(4);\n      return i0.…µ…µresetView(ctx_r24.updateItem(item_r21));\n    });\n    i0.…µ…µtext(13, \"\\u270F\\uFE0F\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(14, \"button\", 31);\n    i0.…µ…µlistener(\"click\", function SalesComponent_div_6_div_11_table_3_tr_14_Template_button_click_14_listener() {\n      const restoredCtx = i0.…µ…µrestoreView(_r23);\n      const item_r21 = restoredCtx.$implicit;\n      const ctx_r25 = i0.…µ…µnextContext(4);\n      return i0.…µ…µresetView(ctx_r25.deleteItem(item_r21));\n    });\n    i0.…µ…µtext(15, \"\\uD83D\\uDDD1\\uFE0F\");\n    i0.…µ…µelementEnd()()();\n  }\n  if (rf & 2) {\n    const item_r21 = ctx.$implicit;\n    i0.…µ…µadvance(2);\n    i0.…µ…µtextInterpolate(item_r21.productName);\n    i0.…µ…µadvance(2);\n    i0.…µ…µtextInterpolate1(\"$\", i0.…µ…µpipeBind2(5, 5, item_r21.unitPrice, \"1.2-2\"), \"\");\n    i0.…µ…µadvance(3);\n    i0.…µ…µpropertyInterpolate1(\"name\", \"qty_\", item_r21.productId, \"\");\n    i0.…µ…µproperty(\"ngModel\", item_r21.quantity);\n    i0.…µ…µadvance(2);\n    i0.…µ…µtextInterpolate1(\"$\", i0.…µ…µpipeBind2(10, 8, item_r21.unitPrice * item_r21.quantity, \"1.2-2\"), \"\");\n  }\n}\nfunction SalesComponent_div_6_div_11_table_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.…µ…µelementStart(0, \"table\", 26)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.…µ…µtext(4, \"Producto\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(5, \"th\");\n    i0.…µ…µtext(6, \"Precio unitario\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(7, \"th\");\n    i0.…µ…µtext(8, \"Cantidad\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(9, \"th\");\n    i0.…µ…µtext(10, \"Subtotal\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(11, \"th\");\n    i0.…µ…µtext(12, \"Acciones\");\n    i0.…µ…µelementEnd()()();\n    i0.…µ…µelementStart(13, \"tbody\");\n    i0.…µ…µtemplate(14, SalesComponent_div_6_div_11_table_3_tr_14_Template, 16, 11, \"tr\", 27);\n    i0.…µ…µelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r18 = i0.…µ…µnextContext(3);\n    i0.…µ…µadvance(14);\n    i0.…µ…µproperty(\"ngForOf\", ctx_r18.cartItems);\n  }\n}\nfunction SalesComponent_div_6_div_11_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.…µ…µelementStart(0, \"div\", 32)(1, \"div\", 33)(2, \"div\")(3, \"strong\");\n    i0.…µ…µtext(4, \"Subtotal:\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µtext(5);\n    i0.…µ…µpipe(6, \"number\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(7, \"div\")(8, \"strong\");\n    i0.…µ…µtext(9, \"IVA (15%):\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µtext(10);\n    i0.…µ…µpipe(11, \"number\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(12, \"div\")(13, \"strong\");\n    i0.…µ…µtext(14, \"Total a pagar:\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µtext(15);\n    i0.…µ…µpipe(16, \"number\");\n    i0.…µ…µelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r19 = i0.…µ…µnextContext(3);\n    i0.…µ…µadvance(5);\n    i0.…µ…µtextInterpolate1(\" $\", i0.…µ…µpipeBind2(6, 3, ctx_r19.cartSubtotal, \"1.2-2\"), \"\");\n    i0.…µ…µadvance(5);\n    i0.…µ…µtextInterpolate1(\" $\", i0.…µ…µpipeBind2(11, 6, ctx_r19.cartIVA, \"1.2-2\"), \"\");\n    i0.…µ…µadvance(5);\n    i0.…µ…µtextInterpolate1(\" $\", i0.…µ…µpipeBind2(16, 9, ctx_r19.cartTotalPagar, \"1.2-2\"), \"\");\n  }\n}\nfunction SalesComponent_div_6_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.…µ…µelementStart(0, \"div\", 16)(1, \"h2\");\n    i0.…µ…µtext(2, \"Detalles del carrito\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µtemplate(3, SalesComponent_div_6_div_11_table_3_Template, 15, 1, \"table\", 24);\n    i0.…µ…µtemplate(4, SalesComponent_div_6_div_11_div_4_Template, 17, 12, \"div\", 25);\n    i0.…µ…µelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.…µ…µnextContext(2);\n    i0.…µ…µadvance(3);\n    i0.…µ…µproperty(\"ngIf\", ctx_r7.cartItems && ctx_r7.cartItems.length);\n    i0.…µ…µadvance(1);\n    i0.…µ…µproperty(\"ngIf\", ctx_r7.cartItems.length);\n  }\n}\nfunction SalesComponent_div_6_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r27 = i0.…µ…µgetCurrentView();\n    i0.…µ…µelementStart(0, \"div\", 16)(1, \"h2\");\n    i0.…µ…µtext(2, \"Crear orden\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(3, \"form\", 34);\n    i0.…µ…µlistener(\"ngSubmit\", function SalesComponent_div_6_div_12_Template_form_ngSubmit_3_listener() {\n      i0.…µ…µrestoreView(_r27);\n      const ctx_r26 = i0.…µ…µnextContext(2);\n      return i0.…µ…µresetView(ctx_r26.createOrder());\n    });\n    i0.…µ…µelementStart(4, \"div\", 35)(5, \"div\", 7)(6, \"label\");\n    i0.…µ…µtext(7, \"Direcci\\u00F3n de env\\u00EDo\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(8, \"input\", 36);\n    i0.…µ…µlistener(\"ngModelChange\", function SalesComponent_div_6_div_12_Template_input_ngModelChange_8_listener($event) {\n      i0.…µ…µrestoreView(_r27);\n      const ctx_r28 = i0.…µ…µnextContext(2);\n      return i0.…µ…µresetView(ctx_r28.shipAddress = $event);\n    });\n    i0.…µ…µelementEnd()()();\n    i0.…µ…µelementStart(9, \"div\", 35)(10, \"div\", 7)(11, \"label\");\n    i0.…µ…µtext(12, \"Ciudad\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(13, \"input\", 37);\n    i0.…µ…µlistener(\"ngModelChange\", function SalesComponent_div_6_div_12_Template_input_ngModelChange_13_listener($event) {\n      i0.…µ…µrestoreView(_r27);\n      const ctx_r29 = i0.…µ…µnextContext(2);\n      return i0.…µ…µresetView(ctx_r29.shipCity = $event);\n    });\n    i0.…µ…µelementEnd()();\n    i0.…µ…µelementStart(14, \"div\", 7)(15, \"label\");\n    i0.…µ…µtext(16, \"Pa\\u00EDs\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(17, \"input\", 38);\n    i0.…µ…µlistener(\"ngModelChange\", function SalesComponent_div_6_div_12_Template_input_ngModelChange_17_listener($event) {\n      i0.…µ…µrestoreView(_r27);\n      const ctx_r30 = i0.…µ…µnextContext(2);\n      return i0.…µ…µresetView(ctx_r30.shipCountry = $event);\n    });\n    i0.…µ…µelementEnd()();\n    i0.…µ…µelementStart(18, \"div\", 21)(19, \"label\");\n    i0.…µ…µtext(20, \"C\\u00F3digo Postal\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(21, \"input\", 39);\n    i0.…µ…µlistener(\"ngModelChange\", function SalesComponent_div_6_div_12_Template_input_ngModelChange_21_listener($event) {\n      i0.…µ…µrestoreView(_r27);\n      const ctx_r31 = i0.…µ…µnextContext(2);\n      return i0.…µ…µresetView(ctx_r31.shipPostalCode = $event);\n    });\n    i0.…µ…µelementEnd()()();\n    i0.…µ…µelementStart(22, \"div\", 40)(23, \"button\", 41);\n    i0.…µ…µtext(24, \"Confirmar orden\");\n    i0.…µ…µelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r8 = i0.…µ…µnextContext(2);\n    i0.…µ…µadvance(8);\n    i0.…µ…µproperty(\"ngModel\", ctx_r8.shipAddress);\n    i0.…µ…µadvance(5);\n    i0.…µ…µproperty(\"ngModel\", ctx_r8.shipCity);\n    i0.…µ…µadvance(4);\n    i0.…µ…µproperty(\"ngModel\", ctx_r8.shipCountry);\n    i0.…µ…µadvance(4);\n    i0.…µ…µproperty(\"ngModel\", ctx_r8.shipPostalCode);\n  }\n}\nfunction SalesComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r33 = i0.…µ…µgetCurrentView();\n    i0.…µ…µelementStart(0, \"div\")(1, \"div\", 6)(2, \"div\", 7)(3, \"label\");\n    i0.…µ…µtext(4, \"Cliente\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µelementStart(5, \"select\", 8);\n    i0.…µ…µlistener(\"ngModelChange\", function SalesComponent_div_6_Template_select_ngModelChange_5_listener($event) {\n      i0.…µ…µrestoreView(_r33);\n      const ctx_r32 = i0.…µ…µnextContext();\n      return i0.…µ…µresetView(ctx_r32.selectedCustomerId = $event);\n    })(\"change\", function SalesComponent_div_6_Template_select_change_5_listener() {\n      i0.…µ…µrestoreView(_r33);\n      const ctx_r34 = i0.…µ…µnextContext();\n      return i0.…µ…µresetView(ctx_r34.onCustomerChange());\n    });\n    i0.…µ…µelementStart(6, \"option\", 9);\n    i0.…µ…µtext(7, \"-- Seleccione un cliente --\");\n    i0.…µ…µelementEnd();\n    i0.…µ…µtemplate(8, SalesComponent_div_6_option_8_Template, 2, 2, \"option\", 10);\n    i0.…µ…µelementEnd()();\n    i0.…µ…µtemplate(9, SalesComponent_div_6_div_9_Template, 7, 2, \"div\", 11);\n    i0.…µ…µelementEnd();\n    i0.…µ…µtemplate(10, SalesComponent_div_6_div_10_Template, 18, 4, \"div\", 12);\n    i0.…µ…µtemplate(11, SalesComponent_div_6_div_11_Template, 5, 2, \"div\", 12);\n    i0.…µ…µtemplate(12, SalesComponent_div_6_div_12_Template, 25, 4, \"div\", 12);\n    i0.…µ…µelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.…µ…µnextContext();\n    i0.…µ…µadvance(5);\n    i0.…µ…µproperty(\"ngModel\", ctx_r3.selectedCustomerId);\n    i0.…µ…µadvance(3);\n    i0.…µ…µproperty(\"ngForOf\", ctx_r3.customers);\n    i0.…µ…µadvance(1);\n    i0.…µ…µproperty(\"ngIf\", ctx_r3.selectedCustomerId);\n    i0.…µ…µadvance(1);\n    i0.…µ…µproperty(\"ngIf\", ctx_r3.selectedCustomerId);\n    i0.…µ…µadvance(1);\n    i0.…µ…µproperty(\"ngIf\", ctx_r3.selectedCustomerId);\n    i0.…µ…µadvance(1);\n    i0.…µ…µproperty(\"ngIf\", ctx_r3.selectedCustomerId && ctx_r3.cartItems.length);\n  }\n}\nexport let SalesComponent = /*#__PURE__*/(() => {\n  class SalesComponent {\n    constructor(salesSvc, prodSvc, customerSvc) {\n      this.salesSvc = salesSvc;\n      this.prodSvc = prodSvc;\n      this.customerSvc = customerSvc;\n      this.customers = [];\n      this.products = [];\n      this.selectedCustomerId = '';\n      this.cartItems = [];\n      this.cartCount = 0;\n      // Subtotales\n      this.cartSubtotal = 0;\n      this.cartIVA = 0;\n      this.cartTotalPagar = 0;\n      // formulario para agregar item\n      this.selectedProductId = null;\n      this.newQuantity = 1;\n      // formulario para crear orden\n      this.shipAddress = '';\n      this.shipCity = '';\n      this.shipCountry = '';\n      this.shipPostalCode = '';\n      this.loading = false;\n      this.error = '';\n      this.success = '';\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        yield _this.loadCustomersAndProducts();\n      })();\n    }\n    loadCustomersAndProducts() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        _this2.loading = true;\n        _this2.error = '';\n        try {\n          const [customers, products] = yield Promise.all([_this2.customerSvc.getCustomers(), _this2.prodSvc.getProducts()]);\n          _this2.customers = customers || [];\n          _this2.products = products || [];\n          _this2.loading = false;\n        } catch (err) {\n          console.error('Error cargando clientes/productos:', err);\n          _this2.error = 'No se pudieron cargar clientes y productos';\n          _this2.loading = false;\n        }\n      })();\n    }\n    // ====== CARRITO ======\n    onCustomerChange() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        _this3.success = '';\n        _this3.error = '';\n        if (!_this3.selectedCustomerId) {\n          _this3.cartItems = [];\n          _this3.cartCount = 0;\n          _this3.cartSubtotal = 0;\n          _this3.cartIVA = 0;\n          _this3.cartTotalPagar = 0;\n          return;\n        }\n        yield _this3.loadCart();\n      })();\n    }\n    loadCart() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this4.selectedCustomerId) return;\n        _this4.loading = true;\n        _this4.error = '';\n        try {\n          const items = yield _this4.salesSvc.getCartByCustomer(_this4.selectedCustomerId);\n          _this4.cartItems = (items || []).map(x => {\n            const prod = _this4.products.find(p => p.id === x.productId);\n            return {\n              ...x,\n              productName: prod ? prod.name : `Producto #${x.productId}`\n            };\n          });\n          // c√°lculos\n          _this4.cartSubtotal = _this4.cartItems.reduce((acc, it) => acc + (it.unitPrice || 0) * (it.quantity || 0), 0);\n          _this4.cartIVA = _this4.cartSubtotal * 0.15;\n          _this4.cartTotalPagar = _this4.cartSubtotal + _this4.cartIVA;\n          _this4.cartCount = _this4.cartItems.reduce((acc, it) => acc + (it.quantity || 0), 0);\n          _this4.loading = false;\n        } catch (err) {\n          console.error('Error al cargar carrito:', err);\n          _this4.error = 'No se pudo cargar el carrito del cliente';\n          _this4.loading = false;\n        }\n      })();\n    }\n    addToCart() {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        _this5.success = '';\n        _this5.error = '';\n        if (!_this5.selectedCustomerId) {\n          _this5.error = 'Seleccione un cliente primero.';\n          return;\n        }\n        if (!_this5.selectedProductId) {\n          _this5.error = 'Seleccione un producto.';\n          return;\n        }\n        if (_this5.newQuantity <= 0) {\n          _this5.error = 'La cantidad debe ser mayor a 0.';\n          return;\n        }\n        const prod = _this5.products.find(p => p.id === _this5.selectedProductId);\n        if (!prod) {\n          _this5.error = 'Producto no encontrado.';\n          return;\n        }\n        const payload = {\n          productId: prod.id,\n          customerId: _this5.selectedCustomerId,\n          unitPrice: prod.unitPrice || 0,\n          quantity: _this5.newQuantity\n        };\n        try {\n          yield _this5.salesSvc.addCartDetail(payload);\n          _this5.success = 'Producto agregado al carrito.';\n          _this5.newQuantity = 1;\n          yield _this5.loadCart();\n        } catch (err) {\n          console.error('Error al agregar al carrito:', err);\n          _this5.error = 'No se pudo agregar el producto al carrito';\n        }\n      })();\n    }\n    updateItem(item) {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        _this6.success = '';\n        _this6.error = '';\n        if (!_this6.selectedCustomerId) return;\n        if (item.quantity <= 0) {\n          _this6.error = 'La cantidad debe ser mayor a 0.';\n          return;\n        }\n        const payload = {\n          productId: item.productId,\n          customerId: _this6.selectedCustomerId,\n          unitPrice: item.unitPrice,\n          quantity: item.quantity\n        };\n        try {\n          yield _this6.salesSvc.updateCartDetail(payload);\n          _this6.success = 'Detalle actualizado.';\n          yield _this6.loadCart();\n        } catch (err) {\n          console.error('Error al actualizar detalle:', err);\n          _this6.error = 'No se pudo actualizar el detalle.';\n        }\n      })();\n    }\n    deleteItem(item) {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        _this7.success = '';\n        _this7.error = '';\n        if (!_this7.selectedCustomerId) return;\n        const ok = confirm(`¬øEliminar del carrito el producto \"${item.productName}\"?`);\n        if (!ok) return;\n        try {\n          yield _this7.salesSvc.deleteCartDetail(_this7.selectedCustomerId, item.productId);\n          _this7.success = 'Producto eliminado del carrito.';\n          yield _this7.loadCart();\n        } catch (err) {\n          console.error('Error al eliminar detalle:', err);\n          _this7.error = 'No se pudo eliminar el producto del carrito.';\n        }\n      })();\n    }\n    clearCart() {\n      var _this8 = this;\n      return _asyncToGenerator(function* () {\n        _this8.success = '';\n        _this8.error = '';\n        if (!_this8.selectedCustomerId) return;\n        const ok = confirm('¬øVaciar todo el carrito de este cliente?');\n        if (!ok) return;\n        try {\n          yield _this8.salesSvc.clearCartByCustomer(_this8.selectedCustomerId);\n          _this8.success = 'Carrito vaciado.';\n          yield _this8.loadCart();\n        } catch (err) {\n          console.error('Error al limpiar carrito:', err);\n          _this8.error = 'No se pudo limpiar el carrito.';\n        }\n      })();\n    }\n    // ====== CREAR ORDEN + PDF ======\n    createOrder() {\n      var _this9 = this;\n      return _asyncToGenerator(function* () {\n        _this9.success = '';\n        _this9.error = '';\n        if (!_this9.selectedCustomerId) {\n          _this9.error = 'Seleccione un cliente.';\n          return;\n        }\n        if (!_this9.cartItems.length) {\n          _this9.error = 'El carrito est√° vac√≠o.';\n          return;\n        }\n        // Validar datos de env√≠o con trim\n        if (!_this9.shipAddress.trim() || !_this9.shipCity.trim() || !_this9.shipCountry.trim() || !_this9.shipPostalCode.trim()) {\n          _this9.error = 'Complete todos los datos de env√≠o.';\n          return;\n        }\n        const payload = {\n          customerId: _this9.selectedCustomerId,\n          shipAddress: _this9.shipAddress.trim(),\n          shipCity: _this9.shipCity.trim(),\n          shipCountry: _this9.shipCountry.trim(),\n          shipPostalCode: _this9.shipPostalCode.trim(),\n          orderDetails: _this9.cartItems.map(it => ({\n            productId: it.productId,\n            unitPrice: it.unitPrice,\n            quantity: it.quantity\n          }))\n        };\n        // üëá LOG para ver qu√© est√°s mandando exactamente\n        console.log('üì¶ Payload a /CreateOrder:', JSON.stringify(payload, null, 2));\n        try {\n          const resp = yield _this9.salesSvc.createOrder(payload);\n          // obtenemos alg√∫n identificador de orden si viene en la respuesta\n          const invoiceNumber = resp?.orderId || resp?.id || new Date().getTime();\n          _this9.success = 'Orden creada correctamente.';\n          // üîπ generar PDF de factura\n          _this9.generateInvoicePdf(invoiceNumber);\n          // opcional: recargar carrito (por si el backend lo limpia)\n          yield _this9.loadCart();\n        } catch (err) {\n          console.error('Error al crear orden:', err);\n          if (err?.error) {\n            console.log('Detalle del error del backend:', err.error);\n            console.log('Detalle JSON:', JSON.stringify(err.error, null, 2));\n          }\n          const backend = err?.error;\n          const detail = backend?.detail;\n          const modelErrors = backend?.errors;\n          if (detail) {\n            _this9.error = detail;\n          } else if (modelErrors) {\n            const mensajes = [];\n            for (const key of Object.keys(modelErrors)) {\n              const arr = modelErrors[key];\n              if (Array.isArray(arr)) {\n                mensajes.push(`${key}: ${arr.join(', ')}`);\n              }\n            }\n            _this9.error = mensajes.join(' | ') || 'Error en los datos de la orden.';\n          } else if (backend?.title) {\n            _this9.error = backend.title;\n          } else {\n            _this9.error = 'No se pudo crear la orden (400). Revisa la consola para m√°s detalles.';\n          }\n        }\n      })();\n    }\n    // ====== GENERAR PDF ======\n    generateInvoicePdf(invoiceNumber) {\n      const doc = new jsPDF();\n      const fecha = new Date().toLocaleString();\n      const customer = this.customers.find(c => c.id === this.selectedCustomerId);\n      // ============= ENCABEZADO =============\n      // Barra superior\n      doc.setFillColor(30, 64, 175); // azul oscuro\n      doc.rect(0, 0, 210, 25, 'F');\n      // Nombre de la empresa\n      doc.setFontSize(18);\n      doc.setTextColor(255, 255, 255);\n      doc.text('Northwind Sales', 14, 16);\n      // Datos de la factura (arriba derecha)\n      doc.setFontSize(11);\n      doc.setTextColor(255, 255, 255);\n      doc.text(`Factura N¬∞: ${invoiceNumber}`, 210 - 14, 10, {\n        align: 'right'\n      });\n      doc.text(`Fecha: ${fecha}`, 210 - 14, 16, {\n        align: 'right'\n      });\n      // T√≠tulo central\n      doc.setFontSize(16);\n      doc.setTextColor(40, 40, 40);\n      doc.text('FACTURA DE VENTA', 105, 35, {\n        align: 'center'\n      });\n      // ============= DATOS CLIENTE / ENV√çO =============\n      const boxStartY = 42;\n      // Caja del cliente\n      doc.setDrawColor(200, 200, 200);\n      doc.setLineWidth(0.3);\n      doc.roundedRect(14, boxStartY, 90, 40, 2, 2); // x, y, w, h\n      doc.setFontSize(11);\n      doc.setTextColor(80, 80, 80);\n      doc.text('Datos del Cliente', 16, boxStartY + 6);\n      doc.setFontSize(10);\n      const clienteNombre = customer ? customer.name : this.selectedCustomerId;\n      doc.text(`Cliente: ${clienteNombre}`, 16, boxStartY + 14);\n      doc.text(`ID: ${this.selectedCustomerId}`, 16, boxStartY + 20);\n      // Caja de env√≠o\n      doc.roundedRect(110, boxStartY, 86, 40, 2, 2);\n      doc.setFontSize(11);\n      doc.text('Datos de Env√≠o', 112, boxStartY + 6);\n      doc.setFontSize(10);\n      doc.text(`Direcci√≥n: ${this.shipAddress}`, 112, boxStartY + 14);\n      doc.text(`Ciudad: ${this.shipCity}`, 112, boxStartY + 20);\n      doc.text(`Pa√≠s: ${this.shipCountry}`, 112, boxStartY + 26);\n      doc.text(`C√≥d. Postal: ${this.shipPostalCode}`, 112, boxStartY + 32);\n      // ============= TABLA DE DETALLES =============\n      const body = this.cartItems.map(it => [it.productName, it.quantity, `$ ${(it.unitPrice || 0).toFixed(2)}`, `$ ${((it.unitPrice || 0) * (it.quantity || 0)).toFixed(2)}`]);\n      autoTable(doc, {\n        startY: boxStartY + 50,\n        head: [['Producto', 'Cant.', 'Precio Unit.', 'Subtotal']],\n        body,\n        styles: {\n          fontSize: 10,\n          cellPadding: 3\n        },\n        headStyles: {\n          fillColor: [30, 64, 175],\n          textColor: 255,\n          halign: 'center'\n        },\n        alternateRowStyles: {\n          fillColor: [245, 248, 255]\n        },\n        columnStyles: {\n          1: {\n            halign: 'center',\n            cellWidth: 20\n          },\n          2: {\n            halign: 'right',\n            cellWidth: 30\n          },\n          3: {\n            halign: 'right',\n            cellWidth: 30\n          }\n        }\n      });\n      // ============= RESUMEN DE TOTALES =============\n      const finalY = doc.lastAutoTable?.finalY || 100;\n      const resumenX = 120;\n      const resumenW = 76;\n      const resumenH = 30;\n      // Caja de totales\n      doc.setDrawColor(200, 200, 200);\n      doc.roundedRect(resumenX, finalY + 6, resumenW, resumenH, 2, 2);\n      doc.setFontSize(11);\n      doc.setTextColor(60, 60, 60);\n      const line1Y = finalY + 14;\n      const line2Y = finalY + 20;\n      const line3Y = finalY + 26;\n      doc.text('Subtotal:', resumenX + 4, line1Y);\n      doc.text('IVA (15%):', resumenX + 4, line2Y);\n      doc.text('TOTAL:', resumenX + 4, line3Y);\n      doc.setFontSize(11);\n      doc.setTextColor(0, 0, 0);\n      doc.text(`$ ${this.cartSubtotal.toFixed(2)}`, resumenX + resumenW - 4, line1Y, {\n        align: 'right'\n      });\n      doc.text(`$ ${this.cartIVA.toFixed(2)}`, resumenX + resumenW - 4, line2Y, {\n        align: 'right'\n      });\n      doc.setFontSize(12);\n      doc.setTextColor(30, 64, 175);\n      doc.text(`$ ${this.cartTotalPagar.toFixed(2)}`, resumenX + resumenW - 4, line3Y, {\n        align: 'right'\n      });\n      // Pie de p√°gina\n      doc.setFontSize(9);\n      doc.setTextColor(130, 130, 130);\n      doc.text('Gracias por su compra.', 14, 290);\n      doc.text('Northwind Sales - Sistema de Ventas', 210 - 14, 290, {\n        align: 'right'\n      });\n      // Descargar\n      doc.save(`factura_${invoiceNumber}.pdf`);\n    }\n    static {\n      this.…µfac = function SalesComponent_Factory(t) {\n        return new (t || SalesComponent)(i0.…µ…µdirectiveInject(i1.SalesService), i0.…µ…µdirectiveInject(i2.ProductService), i0.…µ…µdirectiveInject(i3.CustomerService));\n      };\n    }\n    static {\n      this.…µcmp = /*@__PURE__*/i0.…µ…µdefineComponent({\n        type: SalesComponent,\n        selectors: [[\"app-sales\"]],\n        decls: 7,\n        vars: 4,\n        consts: [[1, \"sales-wrapper\"], [\"class\", \"alert alert-error\", 4, \"ngIf\"], [\"class\", \"alert alert-success\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"alert\", \"alert-error\"], [1, \"alert\", \"alert-success\"], [1, \"filters-row\"], [1, \"field\"], [\"name\", \"customerSelect\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"summary-box\", 4, \"ngIf\"], [\"class\", \"card\", 4, \"ngIf\"], [3, \"value\"], [1, \"summary-box\"], [1, \"btn-secondary\", 3, \"disabled\", \"click\"], [1, \"card\"], [1, \"add-row\"], [\"name\", \"productSelect\", 3, \"ngModel\", \"ngModelChange\"], [3, \"ngValue\"], [3, \"ngValue\", 4, \"ngFor\", \"ngForOf\"], [1, \"field\", \"small\"], [\"type\", \"number\", \"name\", \"quantity\", \"min\", \"1\", 3, \"ngModel\", \"ngModelChange\"], [1, \"btn-primary\", 3, \"click\"], [\"class\", \"cart-table\", 4, \"ngIf\"], [\"class\", \"totals-container\", 4, \"ngIf\"], [1, \"cart-table\"], [4, \"ngFor\", \"ngForOf\"], [\"type\", \"number\", \"min\", \"1\", 3, \"ngModel\", \"name\", \"ngModelChange\"], [1, \"actions-cell\"], [1, \"icon-btn\", \"edit\", 3, \"click\"], [1, \"icon-btn\", \"delete\", 3, \"click\"], [1, \"totals-container\"], [1, \"totals-box\"], [1, \"order-form\", 3, \"ngSubmit\"], [1, \"row\"], [\"type\", \"text\", \"name\", \"shipAddress\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"text\", \"name\", \"shipCity\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"text\", \"name\", \"shipCountry\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"text\", \"name\", \"shipPostalCode\", 3, \"ngModel\", \"ngModelChange\"], [1, \"buttons-row\"], [\"type\", \"submit\", 1, \"btn-primary\"]],\n        template: function SalesComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.…µ…µelementStart(0, \"div\", 0)(1, \"h1\");\n            i0.…µ…µtext(2, \"Gesti\\u00F3n de Ventas\");\n            i0.…µ…µelementEnd();\n            i0.…µ…µtemplate(3, SalesComponent_div_3_Template, 2, 1, \"div\", 1);\n            i0.…µ…µtemplate(4, SalesComponent_div_4_Template, 2, 1, \"div\", 2);\n            i0.…µ…µtemplate(5, SalesComponent_div_5_Template, 2, 0, \"div\", 3);\n            i0.…µ…µtemplate(6, SalesComponent_div_6_Template, 13, 6, \"div\", 3);\n            i0.…µ…µelementEnd();\n          }\n          if (rf & 2) {\n            i0.…µ…µadvance(3);\n            i0.…µ…µproperty(\"ngIf\", ctx.error);\n            i0.…µ…µadvance(1);\n            i0.…µ…µproperty(\"ngIf\", ctx.success);\n            i0.…µ…µadvance(1);\n            i0.…µ…µproperty(\"ngIf\", ctx.loading);\n            i0.…µ…µadvance(1);\n            i0.…µ…µproperty(\"ngIf\", !ctx.loading);\n          }\n        },\n        dependencies: [i4.NgForOf, i4.NgIf, i5.…µNgNoValidate, i5.NgSelectOption, i5.…µNgSelectMultipleOption, i5.DefaultValueAccessor, i5.NumberValueAccessor, i5.SelectControlValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.MinValidator, i5.NgModel, i5.NgForm, i4.DecimalPipe],\n        styles: [\".sales-wrapper[_ngcontent-%COMP%]{width:100%;font-family:Arial,sans-serif}.sales-wrapper[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:12px;color:#164e63}.card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;margin-bottom:8px;color:#0f172a}.alert[_ngcontent-%COMP%]{padding:10px 12px;border-radius:6px;margin-bottom:10px;font-size:14px}.alert-error[_ngcontent-%COMP%]{background:#fee2e2;color:#b91c1c;border:1px solid #fecaca}.alert-success[_ngcontent-%COMP%]{background:#dcfce7;color:#166534;border:1px solid #bbf7d0}.filters-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-end;gap:16px;margin-bottom:12px}.field[_ngcontent-%COMP%]{display:flex;flex-direction:column}.field[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:4px}.field[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .field[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:6px 8px;border-radius:4px;border:1px solid #cbd5e1;min-width:180px}.field.small[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .field.small[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{min-width:80px}.summary-box[_ngcontent-%COMP%]{background:#f1f5f9;border-radius:8px;padding:8px 12px;display:flex;align-items:center;gap:16px}.card[_ngcontent-%COMP%]{background:#ffffff;border-radius:8px;border:1px solid #e2e8f0;padding:12px 14px;margin-top:12px}.cart-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:8px}.cart-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .cart-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e5e7eb;padding:8px 10px;text-align:left}.cart-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f9fafb}.btn-primary[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;border:none;padding:7px 12px;border-radius:6px;cursor:pointer;font-weight:700}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.btn-secondary[_ngcontent-%COMP%]{background-color:#64748b;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}.btn-secondary[_ngcontent-%COMP%]:hover{background-color:#475569}.action-btn-edit[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;border:none;padding:5px 10px;border-radius:4px;margin-right:4px;cursor:pointer}.action-btn-edit[_ngcontent-%COMP%]:hover{background-color:#2c82c9}.action-btn-delete[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff;border:none;padding:5px 10px;border-radius:4px;cursor:pointer}.action-btn-delete[_ngcontent-%COMP%]:hover{background-color:#c0392b}.add-row[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:flex-end}.order-form[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;gap:12px;margin-bottom:8px}.buttons-row[_ngcontent-%COMP%]{margin-top:10px}.totals-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;width:100%;margin-top:15px}.totals-box[_ngcontent-%COMP%]{padding:14px;background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;min-width:260px;max-width:300px;font-size:15px;line-height:1.7;box-shadow:0 2px 6px #0000000f}.totals-box[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-bottom:4px}.totals-box[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{font-size:17px;font-weight:700}.actions-cell[_ngcontent-%COMP%]{display:flex;gap:8px}.icon-btn[_ngcontent-%COMP%]{width:32px;height:32px;border-radius:6px;cursor:pointer;border:none;font-size:18px;display:flex;align-items:center;justify-content:center;transition:.2s ease}.icon-btn.edit[_ngcontent-%COMP%]{background:#3498db;color:#fff}.icon-btn.delete[_ngcontent-%COMP%]{background:#e74c3c;color:#fff}.icon-btn[_ngcontent-%COMP%]:hover{transform:scale(1.1);filter:brightness(1.15)}.icon-btn[_ngcontent-%COMP%]:active{transform:scale(.95)}\"]\n      });\n    }\n  }\n  return SalesComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}