{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/HP/Desktop/angular-app-actualizado/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nimport { Component } from '@angular/core';\nimport { CustomerService } from '../services/customer.service';\nexport let CustomersComponent = class CustomersComponent {\n  constructor(customerSvc) {\n    this.customerSvc = customerSvc;\n    this.customers = [];\n    this.loading = true;\n    this.error = '';\n    this.formSubmitted = false;\n    // MODAL CREAR\n    this.isCreateModalOpen = false;\n    this.newCustomer = {\n      firstName: '',\n      lastName: '',\n      email: '',\n      password: '',\n      cedula: '',\n      phoneNumber: ''\n    };\n    // MODAL EDITAR\n    this.isEditModalOpen = false;\n    this.editCustomerId = null;\n    this.editCustomer = {\n      firstName: '',\n      lastName: '',\n      email: '',\n      cedula: '',\n      phoneNumber: ''\n    };\n    // MODAL DELETE\n    this.isDeleteModalOpen = false;\n    this.customerToDelete = null;\n  }\n  ngOnInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      yield _this.loadCustomers();\n    })();\n  }\n  loadCustomers() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.loading = true;\n      _this2.error = '';\n      try {\n        const data = yield _this2.customerSvc.getCustomers();\n        _this2.customers = data || [];\n      } catch (err) {\n        _this2.error = 'Error al cargar usuarios.';\n        console.error(err);\n      }\n      _this2.loading = false;\n    })();\n  }\n  // ================= VALIDACIONES LÓGICAS =================\n  // 1. Convertir a Mayúsculas automáticamente\n  sanitizeInput(type) {\n    if (type === 'new') {\n      this.newCustomer.firstName = this.newCustomer.firstName.toUpperCase();\n      this.newCustomer.lastName = this.newCustomer.lastName.toUpperCase();\n    } else {\n      this.editCustomer.firstName = this.editCustomer.firstName.toUpperCase();\n      this.editCustomer.lastName = this.editCustomer.lastName.toUpperCase();\n    }\n  }\n  // 2. Validar Nombres (Solo letras, espacios, acentos) - NO números ni símbolos\n  isNameValid(name) {\n    const regex = /^[a-zA-ZÀ-ÿ\\s]+$/;\n    return regex.test(name);\n  }\n  // 3. Validar Email (RFC Standard básico)\n  isEmailValid(email) {\n    // Regex estándar para emails\n    const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;\n    return regex.test(email);\n  }\n  // 4. Chequear duplicados (en memoria local de la lista cargada)\n  isEmailDuplicate(email, excludeId) {\n    return this.customers.some(c => c.email.toLowerCase() === email.toLowerCase() && c.id !== excludeId);\n  }\n  // 5. Validar Contraseña Fuerte\n  // Min 8 chars, 1 mayúscula, 1 número, 1 caracter especial\n  isPasswordStrong(pass) {\n    // (?=.*[A-Z]) -> al menos una mayúscula\n    // (?=.*[0-9]) -> al menos un número\n    // (?=.*[!@#\\$%\\^&\\*]) -> al menos un caracter especial (ajusta según necesites)\n    // .{8,} -> longitud minima 8\n    const regex = /^(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\\$%\\^&\\*]).{8,}$/;\n    return regex.test(pass);\n  }\n  // ================= CREAR =================\n  openCreateModal() {\n    this.newCustomer = {\n      firstName: '',\n      lastName: '',\n      email: '',\n      password: '',\n      cedula: '',\n      phoneNumber: ''\n    };\n    this.isCreateModalOpen = true;\n    this.formSubmitted = false;\n    this.error = '';\n  }\n  closeCreateModal() {\n    this.isCreateModalOpen = false;\n  }\n  createCustomer() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      _this3.formSubmitted = true;\n      _this3.error = '';\n      const {\n        firstName,\n        lastName,\n        email,\n        password\n      } = _this3.newCustomer;\n      // --- Validaciones ---\n      if (!firstName || !_this3.isNameValid(firstName)) {\n        _this3.error = 'El nombre es inválido o contiene caracteres prohibidos.';\n        return;\n      }\n      if (!lastName || !_this3.isNameValid(lastName)) {\n        _this3.error = 'El apellido es inválido o contiene caracteres prohibidos.';\n        return;\n      }\n      if (!email || !_this3.isEmailValid(email)) {\n        _this3.error = 'El correo electrónico no es válido.';\n        return;\n      }\n      if (_this3.isEmailDuplicate(email)) {\n        _this3.error = 'Ya existe un usuario registrado con ese correo.';\n        return;\n      }\n      if (!password || !_this3.isPasswordStrong(password)) {\n        _this3.error = 'La contraseña es muy débil (Requiere Mayúscula, Número y Carácter especial).';\n        return;\n      }\n      try {\n        yield _this3.customerSvc.createCustomer(_this3.newCustomer);\n        yield _this3.loadCustomers();\n        _this3.closeCreateModal();\n      } catch (err) {\n        console.error(err);\n        _this3.error = 'No se pudo crear el usuario. Verifique los datos.';\n      }\n    })();\n  }\n  // ================= EDITAR =================\n  openEditModal(c) {\n    this.editCustomerId = c.id;\n    this.editCustomer = {\n      firstName: c.firstName,\n      lastName: c.lastName,\n      email: c.email,\n      cedula: c.cedula,\n      phoneNumber: c.phoneNumber\n    };\n    // Forzar mayúsculas al abrir por si acaso venía en minúsculas\n    this.sanitizeInput('edit');\n    this.isEditModalOpen = true;\n    this.formSubmitted = false;\n    this.error = '';\n  }\n  closeEditModal() {\n    this.isEditModalOpen = false;\n    this.editCustomerId = null;\n  }\n  updateCustomer() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      _this4.formSubmitted = true;\n      _this4.error = '';\n      if (!_this4.editCustomerId) return;\n      const {\n        firstName,\n        lastName,\n        email\n      } = _this4.editCustomer;\n      // --- Validaciones Edit ---\n      if (!firstName || !_this4.isNameValid(firstName)) {\n        _this4.error = 'Nombre inválido.';\n        return;\n      }\n      if (!lastName || !_this4.isNameValid(lastName)) {\n        _this4.error = 'Apellido inválido.';\n        return;\n      }\n      if (!email || !_this4.isEmailValid(email)) {\n        _this4.error = 'Correo inválido.';\n        return;\n      }\n      if (_this4.isEmailDuplicate(email, _this4.editCustomerId)) {\n        _this4.error = 'Ese correo ya pertenece a otro usuario.';\n        return;\n      }\n      try {\n        yield _this4.customerSvc.updateCustomer(_this4.editCustomerId, _this4.editCustomer);\n        yield _this4.loadCustomers();\n        _this4.closeEditModal();\n      } catch (err) {\n        console.error(err);\n        _this4.error = 'No se pudo actualizar el usuario.';\n      }\n    })();\n  }\n  // ================= ELIMINAR =================\n  openDeleteModal(c) {\n    this.customerToDelete = c;\n    this.isDeleteModalOpen = true;\n    this.error = '';\n  }\n  closeDeleteModal() {\n    this.isDeleteModalOpen = false;\n    this.customerToDelete = null;\n  }\n  confirmDelete() {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this5.customerToDelete) return;\n      try {\n        yield _this5.customerSvc.deleteCustomer(_this5.customerToDelete.id);\n        yield _this5.loadCustomers();\n        _this5.closeDeleteModal();\n      } catch (err) {\n        _this5.closeDeleteModal(); // Cierra el modal de confirmación\n        _this5.error = 'No se pudo eliminar el usuario.';\n      }\n    })();\n  }\n};\nCustomersComponent = __decorate([Component({\n  selector: 'app-customers',\n  templateUrl: './customers.component.html',\n  styleUrls: ['./customers.component.css']\n}), __metadata(\"design:paramtypes\", [CustomerService])], CustomersComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}