{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/HP/Desktop/6 Semestre/Aplicaciones Moviles/angular-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { Router } from '@angular/router';\nimport { HttpClient } from '@angular/common/http';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction LoginComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r0.errorMessage);\n  }\n}\nexport let LoginComponent = /*#__PURE__*/(() => {\n  class LoginComponent {\n    constructor(http, router) {\n      this.http = http;\n      this.router = router;\n      this.username = '';\n      this.password = '';\n      this.errorMessage = '';\n    }\n    onSubmit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        _this.errorMessage = '';\n        if (!_this.username || !_this.password) {\n          _this.errorMessage = 'Por favor, ingrese usuario y contraseña.';\n          return;\n        }\n        try {\n          const resp = yield _this.http.post('https://localhost:7239/users/Login', {\n            email: _this.username,\n            password: _this.password\n          }, {\n            responseType: 'json'\n          }).toPromise();\n          const token = resp?.token || resp?.accessToken || resp?.Token || resp?.jwt || '';\n          if (!token || typeof token !== 'string' || token.length < 10) {\n            _this.errorMessage = 'Token inválido recibido del servidor.';\n            return;\n          }\n          localStorage.setItem('token', token);\n          // No guardamos la respuesta cruda por seguridad; solo el token y permisos normalizados.\n          // Obtener permisos\n          try {\n            let permisos = null;\n            try {\n              permisos = yield _this.http.get('https://localhost:7239/permissions/obtenerPermisos', {\n                headers: {\n                  Authorization: 'Bearer ' + token\n                }\n              }).toPromise();\n              // Normalizar la forma de los permisos: algunos endpoints devuelven un array directamente,\n              // otros devuelven { permisos: [...] } o { data: [...] } — queremos una lista.\n              if (!permisos) permisos = [];else if (Array.isArray(permisos)) permisos = permisos;else if (permisos.permisos && Array.isArray(permisos.permisos)) permisos = permisos.permisos;else if (permisos.data && Array.isArray(permisos.data)) permisos = permisos.data;else {\n                // si no es un array conocido, lo guardamos como array vacío para evitar fallas.\n                permisos = [];\n              }\n              localStorage.setItem('permisos', JSON.stringify(permisos));\n            } catch (e) {\n              console.error('Error al obtener permisos:', e);\n              // Guardamos como arreglo vacío para evitar que el dashboard haga crashes inesperados\n              localStorage.setItem('permisos', JSON.stringify([]));\n              // No re-lanzamos: permitimos que el dashboard intente obtener permisos de nuevo.\n            }\n\n            _this.router.navigate(['/dashboard']);\n          } catch (err) {\n            // Ya convertimos y guardamos permisos, si sucede algo aquí simplemente mostramos aviso\n            console.warn('Aviso: ocurrió un problema al intentar procesar permisos durante login.', err);\n          }\n          // Evitar prints con datos sensibles\n        } catch (err) {\n          if (err?.status === 401) _this.errorMessage = 'Usuario o contraseña incorrectos.';else _this.errorMessage = 'No se pudo conectar con el servidor.';\n        }\n      })();\n    }\n    static {\n      this.ɵfac = function LoginComponent_Factory(t) {\n        return new (t || LoginComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: LoginComponent,\n        selectors: [[\"app-login\"]],\n        decls: 22,\n        vars: 3,\n        consts: [[1, \"login-container\"], [1, \"left-section\"], [1, \"description\"], [\"src\", \"assets/images/carrito.png\", \"alt\", \"Compra\", 1, \"login-image\"], [1, \"right-section\"], [1, \"login-box\"], [1, \"login-form\", 3, \"ngSubmit\"], [1, \"input-group\"], [\"name\", \"username\", \"type\", \"text\", \"placeholder\", \"Usuario\", \"required\", \"\", \"autocomplete\", \"username\", 3, \"ngModel\", \"ngModelChange\"], [\"name\", \"password\", \"type\", \"password\", \"placeholder\", \"Contrase\\u00F1a\", \"required\", \"\", \"autocomplete\", \"current-password\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"submit\", 1, \"login-btn\"], [\"class\", \"error-message\", 4, \"ngIf\"], [1, \"options\"], [\"href\", \"#\", 1, \"forgot-password\"], [1, \"error-message\"]],\n        template: function LoginComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\");\n            i0.ɵɵtext(3, \"Sistema de Ventas\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"p\", 2);\n            i0.ɵɵtext(5, \"Gestiona tus ventas de manera eficiente y profesional\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(6, \"img\", 3);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(7, \"div\", 4)(8, \"div\", 5)(9, \"h2\");\n            i0.ɵɵtext(10, \"Iniciar Sesi\\u00F3n\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(11, \"form\", 6);\n            i0.ɵɵlistener(\"ngSubmit\", function LoginComponent_Template_form_ngSubmit_11_listener() {\n              return ctx.onSubmit();\n            });\n            i0.ɵɵelementStart(12, \"div\", 7)(13, \"input\", 8);\n            i0.ɵɵlistener(\"ngModelChange\", function LoginComponent_Template_input_ngModelChange_13_listener($event) {\n              return ctx.username = $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(14, \"div\", 7)(15, \"input\", 9);\n            i0.ɵɵlistener(\"ngModelChange\", function LoginComponent_Template_input_ngModelChange_15_listener($event) {\n              return ctx.password = $event;\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(16, \"button\", 10);\n            i0.ɵɵtext(17, \"Iniciar Sesi\\u00F3n\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(18, LoginComponent_div_18_Template, 2, 1, \"div\", 11);\n            i0.ɵɵelementStart(19, \"div\", 12)(20, \"a\", 13);\n            i0.ɵɵtext(21, \"\\u00BFOlvidaste tu contrase\\u00F1a?\");\n            i0.ɵɵelementEnd()()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(13);\n            i0.ɵɵproperty(\"ngModel\", ctx.username);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngModel\", ctx.password);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.errorMessage);\n          }\n        },\n        dependencies: [i3.NgIf, i4.ɵNgNoValidate, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.RequiredValidator, i4.NgModel, i4.NgForm],\n        styles: [\"[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:calc(100vh + -0px)}.login-container[_ngcontent-%COMP%]{display:flex;max-width:1000px;width:100%;gap:60px;align-items:center;padding:40px}.left-section[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;gap:20px}.login-image[_ngcontent-%COMP%]{max-width:300px;height:auto;border-radius:12px}.left-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#fff;font-size:42px;font-weight:700;text-align:center}.description[_ngcontent-%COMP%]{color:#e0e7ff;font-size:18px;line-height:1.6;text-align:center}.right-section[_ngcontent-%COMP%]{flex:0 0 400px}.login-box[_ngcontent-%COMP%]{background:#ffffff;border-radius:12px;padding:40px;box-shadow:0 10px 40px #00000026}h2[_ngcontent-%COMP%]{color:#1e3a8a;font-size:24px;font-weight:600;margin-bottom:24px;text-align:center}.login-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}input[type=text][_ngcontent-%COMP%], input[type=password][_ngcontent-%COMP%]{width:100%;padding:14px 16px;border:2px solid #e5e7eb;border-radius:8px;font-size:15px}.login-btn[_ngcontent-%COMP%]{width:100%;padding:14px;background:linear-gradient(135deg,#1e3a8a 0%,#3b82f6 100%);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:700;cursor:pointer}.error-message[_ngcontent-%COMP%]{background-color:#fee2e2;color:#dc2626;padding:12px;border-radius:8px;font-size:14px;text-align:center;border:1px solid #fecaca;margin-top:8px}@media (max-width: 768px){.login-container[_ngcontent-%COMP%]{flex-direction:column;gap:30px}.left-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:32px}.right-section[_ngcontent-%COMP%]{width:100%;max-width:400px}}\"]\n      });\n    }\n  }\n  return LoginComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}