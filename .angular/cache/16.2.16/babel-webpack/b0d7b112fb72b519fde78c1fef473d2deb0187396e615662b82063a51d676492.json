{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/User/Desktop/angular-app/angular-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar _a;\n// src/app/users/users.component.ts\nimport { Component } from '@angular/core';\nimport { UserService } from '../services/user.service';\nexport let UsersComponent = class UsersComponent {\n  constructor(userSvc) {\n    this.userSvc = userSvc;\n    // ... (users, roles, loading, error, success, etc.)\n    // EDITAR USUARIO (ya lo tenÃ­as)\n    this.isEditModalOpen = false;\n    this.editUserId = null;\n    this.editUser = {\n      firstName: '',\n      lastName: '',\n      phoneNumber: '',\n      emailConfirmed: false,\n      lockoutEnabled: false,\n      lockoutEnd: null\n    };\n    // ðŸ‘‰ NUEVO: informaciÃ³n de roles en el modal de ediciÃ³n\n    this.editUserRoles = []; // nombres de roles que tiene el usuario\n    this.editCurrentRoleId = ''; // id del rol actual seleccionado\n    this.editNewRoleId = ''; // id del rol nuevo seleccionado\n  }\n  // ... ngOnInit, loadUsers, loadRoles, crear usuario, etc.\n  openEditModal(user) {\n    this.editUserId = user.id;\n    this.editUser = {\n      firstName: user.firstName || '',\n      lastName: user.lastName || '',\n      phoneNumber: user.phoneNumber || '',\n      emailConfirmed: !!user.emailConfirmed,\n      lockoutEnabled: !!user.lockoutEnabled,\n      lockoutEnd: user.lockoutEnd || null\n    };\n    this.editUserRoles = user.roles || [];\n    // si tiene roles, tomar el primero como seleccionado por defecto\n    if (this.editUserRoles.length > 0) {\n      this.editCurrentRoleId = this.findRoleIdByName(this.editUserRoles[0]);\n    } else {\n      this.editCurrentRoleId = '';\n    }\n    this.editNewRoleId = '';\n    this.isEditModalOpen = true;\n    this.error = '';\n    this.success = '';\n  }\n  closeEditModal() {\n    this.isEditModalOpen = false;\n    this.editUserId = null;\n    this.editUserRoles = [];\n    this.editCurrentRoleId = '';\n    this.editNewRoleId = '';\n  }\n  saveEdit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if (!_this.editUserId) return;\n      _this.error = '';\n      _this.success = '';\n      try {\n        // solo datos bÃ¡sicos (nombre, telÃ©fono, bloqueado...)\n        yield _this.userSvc.updateUser(_this.editUserId, _this.editUser);\n        _this.success = 'Datos del usuario actualizados correctamente';\n        yield _this.loadUsers();\n        // el rol se maneja con botones separados (changeRole/removeRole)\n      } catch (err) {\n        console.error(err);\n        _this.error = 'No se pudieron actualizar los datos del usuario';\n      }\n    })();\n  }\n  // ðŸ‘‰ encontrar ID de rol por nombre (porque en users.roles vienen nombres)\n  findRoleIdByName(name) {\n    const r = this.roles.find(x => x.name === name);\n    return r ? r.id : '';\n  }\n  // ðŸ‘‰ CAMBIAR / ASIGNAR ROL\n  changeRole() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this2.editUserId) return;\n      _this2.error = '';\n      _this2.success = '';\n      try {\n        if (_this2.editUserRoles.length === 0) {\n          // usuario sin rol â†’ asignar nuevo\n          if (!_this2.editNewRoleId) {\n            _this2.error = 'Seleccione un rol para asignar.';\n            return;\n          }\n          yield _this2.userSvc.assignRoleToUser(_this2.editUserId, _this2.editNewRoleId);\n        } else {\n          // usuario con rol â†’ actualizar usando currentRoleId y newRoleId\n          if (!_this2.editCurrentRoleId || !_this2.editNewRoleId) {\n            _this2.error = 'Seleccione el rol actual y el nuevo rol.';\n            return;\n          }\n          yield _this2.userSvc.updateUserRole(_this2.editUserId, _this2.editCurrentRoleId, _this2.editNewRoleId);\n        }\n        _this2.success = 'Rol actualizado correctamente.';\n        yield _this2.loadUsers();\n        // refrescar roles del usuario visible en el modal\n        const updated = _this2.users.find(u => u.id === _this2.editUserId);\n        _this2.editUserRoles = updated?.roles || [];\n        if (_this2.editUserRoles.length > 0) {\n          _this2.editCurrentRoleId = _this2.findRoleIdByName(_this2.editUserRoles[0]);\n        } else {\n          _this2.editCurrentRoleId = '';\n        }\n        _this2.editNewRoleId = '';\n      } catch (err) {\n        console.error(err);\n        _this2.error = 'No se pudo actualizar el rol del usuario.';\n      }\n    })();\n  }\n  // ðŸ‘‰ QUITAR ROL\n  removeRole() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this3.editUserId || !_this3.editCurrentRoleId) {\n        _this3.error = 'Seleccione un rol a eliminar.';\n        return;\n      }\n      _this3.error = '';\n      _this3.success = '';\n      try {\n        yield _this3.userSvc.removeUserRole(_this3.editUserId, _this3.editCurrentRoleId);\n        _this3.success = 'Rol eliminado del usuario.';\n        yield _this3.loadUsers();\n        const updated = _this3.users.find(u => u.id === _this3.editUserId);\n        _this3.editUserRoles = updated?.roles || [];\n        if (_this3.editUserRoles.length > 0) {\n          _this3.editCurrentRoleId = _this3.findRoleIdByName(_this3.editUserRoles[0]);\n        } else {\n          _this3.editCurrentRoleId = '';\n        }\n        _this3.editNewRoleId = '';\n      } catch (err) {\n        console.error(err);\n        _this3.error = 'No se pudo quitar el rol del usuario.';\n      }\n    })();\n  }\n};\nUsersComponent = __decorate([Component({\n  selector: 'app-users',\n  templateUrl: './users.component.html',\n  styleUrls: ['./users.component.css']\n}), __metadata(\"design:paramtypes\", [typeof (_a = typeof UserService !== \"undefined\" && UserService) === \"function\" ? _a : Object])], UsersComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}