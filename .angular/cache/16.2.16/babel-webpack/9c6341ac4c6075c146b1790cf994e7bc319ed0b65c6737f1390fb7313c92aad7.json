{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/HP/Desktop/angular-app-actualizado/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { OrderService } from \"../services/order.service\";\nimport { CustomerService } from \"../services/customer.service\";\nimport { ProductService } from \"../services/product.service\";\n// ðŸ‘‰ imports para generar PDF\nimport jsPDF from \"jspdf\";\nimport autoTable from \"jspdf-autotable\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../services/order.service\";\nimport * as i2 from \"../services/customer.service\";\nimport * as i3 from \"../services/product.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nfunction OrdersComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 13);\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate(ctx_r0.error);\n  }\n}\nfunction OrdersComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\", 14);\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate(ctx_r1.success);\n  }\n}\nfunction OrdersComponent_option_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"option\", 15);\n    i0.ÉµÉµtext(1);\n    i0.ÉµÉµelementEnd();\n  }\n  if (rf & 2) {\n    const c_r6 = ctx.$implicit;\n    const ctx_r2 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµproperty(\"value\", c_r6.id);\n    i0.ÉµÉµadvance(1);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r2.getCustomerLabel(c_r6), \" \");\n  }\n}\nfunction OrdersComponent_table_15_tr_16_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"tr\")(1, \"td\");\n    i0.ÉµÉµtext(2);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(3, \"td\");\n    i0.ÉµÉµtext(4);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(5, \"td\");\n    i0.ÉµÉµtext(6);\n    i0.ÉµÉµpipe(7, \"date\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(8, \"td\");\n    i0.ÉµÉµtext(9);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(10, \"td\");\n    i0.ÉµÉµtext(11);\n    i0.ÉµÉµpipe(12, \"currency\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(13, \"td\", 17)(14, \"button\", 19);\n    i0.ÉµÉµlistener(\"click\", function OrdersComponent_table_15_tr_16_Template_button_click_14_listener() {\n      const restoredCtx = i0.ÉµÉµrestoreView(_r10);\n      const o_r8 = restoredCtx.$implicit;\n      const ctx_r9 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r9.openDetail(o_r8));\n    });\n    i0.ÉµÉµelement(15, \"i\", 20);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(16, \"button\", 21);\n    i0.ÉµÉµlistener(\"click\", function OrdersComponent_table_15_tr_16_Template_button_click_16_listener() {\n      const restoredCtx = i0.ÉµÉµrestoreView(_r10);\n      const o_r8 = restoredCtx.$implicit;\n      const ctx_r11 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r11.openEdit(o_r8));\n    });\n    i0.ÉµÉµelement(17, \"i\", 22);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(18, \"button\", 23);\n    i0.ÉµÉµlistener(\"click\", function OrdersComponent_table_15_tr_16_Template_button_click_18_listener() {\n      const restoredCtx = i0.ÉµÉµrestoreView(_r10);\n      const o_r8 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r12.downloadPdf(o_r8));\n    });\n    i0.ÉµÉµelement(19, \"i\", 24);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(20, \"button\", 25);\n    i0.ÉµÉµlistener(\"click\", function OrdersComponent_table_15_tr_16_Template_button_click_20_listener() {\n      const restoredCtx = i0.ÉµÉµrestoreView(_r10);\n      const o_r8 = restoredCtx.$implicit;\n      const ctx_r13 = i0.ÉµÉµnextContext(2);\n      return i0.ÉµÉµresetView(ctx_r13.deleteOrder(o_r8));\n    });\n    i0.ÉµÉµelement(21, \"i\", 26);\n    i0.ÉµÉµelementEnd()()();\n  }\n  if (rf & 2) {\n    const o_r8 = ctx.$implicit;\n    const ctx_r7 = i0.ÉµÉµnextContext(2);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(o_r8.id);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(ctx_r7.getCustomerName(o_r8));\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(i0.ÉµÉµpipeBind2(7, 7, o_r8.orderDate, \"short\"));\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµtextInterpolate3(\" \", o_r8.shipAddress, \", \", o_r8.shipCity, \", \", o_r8.shipCountry, \" \");\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate1(\" \", i0.ÉµÉµpipeBind3(12, 10, ctx_r7.getOrderTotal(o_r8), \"USD\", \"symbol\"), \" \");\n  }\n}\nfunction OrdersComponent_table_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"table\", 16)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ÉµÉµtext(4, \"ID\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(5, \"th\");\n    i0.ÉµÉµtext(6, \"Cliente\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(7, \"th\");\n    i0.ÉµÉµtext(8, \"Fecha\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(9, \"th\");\n    i0.ÉµÉµtext(10, \"Direcci\\u00F3n Env\\u00EDo\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(11, \"th\");\n    i0.ÉµÉµtext(12, \"Total\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(13, \"th\", 17);\n    i0.ÉµÉµtext(14, \"Acciones\");\n    i0.ÉµÉµelementEnd()()();\n    i0.ÉµÉµelementStart(15, \"tbody\");\n    i0.ÉµÉµtemplate(16, OrdersComponent_table_15_tr_16_Template, 22, 14, \"tr\", 18);\n    i0.ÉµÉµelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(16);\n    i0.ÉµÉµproperty(\"ngForOf\", ctx_r3.filteredOrders);\n  }\n}\nfunction OrdersComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"div\")(1, \"p\");\n    i0.ÉµÉµtext(2, \"No hay \\u00F3rdenes disponibles.\");\n    i0.ÉµÉµelementEnd()();\n  }\n}\nfunction OrdersComponent_div_17_tr_59_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ÉµÉµelementStart(0, \"tr\")(1, \"td\");\n    i0.ÉµÉµtext(2);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(3, \"td\");\n    i0.ÉµÉµtext(4);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(5, \"td\");\n    i0.ÉµÉµtext(6);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(7, \"td\");\n    i0.ÉµÉµtext(8);\n    i0.ÉµÉµelementEnd()();\n  }\n  if (rf & 2) {\n    const d_r15 = ctx.$implicit;\n    const ctx_r14 = i0.ÉµÉµnextContext(2);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(ctx_r14.getProductName(d_r15.productId));\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate(d_r15.quantity);\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate1(\"$ \", d_r15.unitPrice.toFixed(2), \"\");\n    i0.ÉµÉµadvance(2);\n    i0.ÉµÉµtextInterpolate1(\"$ \", (d_r15.quantity * d_r15.unitPrice).toFixed(2), \"\");\n  }\n}\nfunction OrdersComponent_div_17_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ÉµÉµgetCurrentView();\n    i0.ÉµÉµelementStart(0, \"div\", 27)(1, \"div\", 28)(2, \"h2\");\n    i0.ÉµÉµtext(3);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(4, \"button\", 29);\n    i0.ÉµÉµlistener(\"click\", function OrdersComponent_div_17_Template_button_click_4_listener() {\n      i0.ÉµÉµrestoreView(_r17);\n      const ctx_r16 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r16.closeDetailModal());\n    });\n    i0.ÉµÉµelement(5, \"i\", 30);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(6, \"div\", 31)(7, \"h3\");\n    i0.ÉµÉµtext(8, \"Cliente\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(9, \"p\")(10, \"strong\");\n    i0.ÉµÉµtext(11, \"Nombre:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(12);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(13, \"p\")(14, \"strong\");\n    i0.ÉµÉµtext(15, \"C\\u00E9dula:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(16);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(17, \"p\")(18, \"strong\");\n    i0.ÉµÉµtext(19, \"Email:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(20);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(21, \"p\")(22, \"strong\");\n    i0.ÉµÉµtext(23, \"Tel\\u00E9fono:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(24);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(25, \"div\", 31)(26, \"h3\");\n    i0.ÉµÉµtext(27, \"Informaci\\u00F3n de Env\\u00EDo\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(28, \"p\")(29, \"strong\");\n    i0.ÉµÉµtext(30, \"Direcci\\u00F3n:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(31);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(32, \"p\")(33, \"strong\");\n    i0.ÉµÉµtext(34, \"Ciudad:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(35);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(36, \"p\")(37, \"strong\");\n    i0.ÉµÉµtext(38, \"Pa\\u00EDs:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(39);\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(40, \"p\")(41, \"strong\");\n    i0.ÉµÉµtext(42, \"C\\u00F3digo Postal:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(43);\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(44, \"div\", 31)(45, \"h3\");\n    i0.ÉµÉµtext(46, \"Productos Comprados\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(47, \"table\", 32)(48, \"thead\")(49, \"tr\")(50, \"th\");\n    i0.ÉµÉµtext(51, \"Producto\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(52, \"th\");\n    i0.ÉµÉµtext(53, \"Cantidad\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(54, \"th\");\n    i0.ÉµÉµtext(55, \"Precio Unit.\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(56, \"th\");\n    i0.ÉµÉµtext(57, \"Subtotal\");\n    i0.ÉµÉµelementEnd()()();\n    i0.ÉµÉµelementStart(58, \"tbody\");\n    i0.ÉµÉµtemplate(59, OrdersComponent_div_17_tr_59_Template, 9, 4, \"tr\", 18);\n    i0.ÉµÉµelementEnd()()();\n    i0.ÉµÉµelementStart(60, \"div\", 33)(61, \"p\")(62, \"strong\");\n    i0.ÉµÉµtext(63, \"Subtotal:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(64);\n    i0.ÉµÉµpipe(65, \"number\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(66, \"p\")(67, \"strong\");\n    i0.ÉµÉµtext(68, \"IVA 15%:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(69);\n    i0.ÉµÉµpipe(70, \"number\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµelementStart(71, \"p\")(72, \"strong\");\n    i0.ÉµÉµtext(73, \"Total:\");\n    i0.ÉµÉµelementEnd();\n    i0.ÉµÉµtext(74);\n    i0.ÉµÉµpipe(75, \"number\");\n    i0.ÉµÉµelementEnd()();\n    i0.ÉµÉµelementStart(76, \"div\", 34)(77, \"button\", 35);\n    i0.ÉµÉµlistener(\"click\", function OrdersComponent_div_17_Template_button_click_77_listener() {\n      i0.ÉµÉµrestoreView(_r17);\n      const ctx_r18 = i0.ÉµÉµnextContext();\n      return i0.ÉµÉµresetView(ctx_r18.downloadPdf(ctx_r18.detailOrder));\n    });\n    i0.ÉµÉµelement(78, \"i\", 24);\n    i0.ÉµÉµtext(79, \" Descargar PDF \");\n    i0.ÉµÉµelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ÉµÉµnextContext();\n    i0.ÉµÉµadvance(3);\n    i0.ÉµÉµtextInterpolate1(\"Detalle de la Orden #\", ctx_r5.detailOrder == null ? null : ctx_r5.detailOrder.id, \"\");\n    i0.ÉµÉµadvance(9);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r5.getCustomerName(ctx_r5.detailOrder), \"\");\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r5.getCustomerCedula(ctx_r5.detailOrder), \"\");\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r5.getCustomerEmail(ctx_r5.detailOrder), \"\");\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r5.getCustomerPhone(ctx_r5.detailOrder), \"\");\n    i0.ÉµÉµadvance(7);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r5.detailOrder == null ? null : ctx_r5.detailOrder.shipAddress, \"\");\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r5.detailOrder == null ? null : ctx_r5.detailOrder.shipCity, \"\");\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r5.detailOrder == null ? null : ctx_r5.detailOrder.shipCountry, \"\");\n    i0.ÉµÉµadvance(4);\n    i0.ÉµÉµtextInterpolate1(\" \", ctx_r5.detailOrder == null ? null : ctx_r5.detailOrder.shipPostalCode, \"\");\n    i0.ÉµÉµadvance(16);\n    i0.ÉµÉµproperty(\"ngForOf\", ctx_r5.detailOrder == null ? null : ctx_r5.detailOrder.orderDetails);\n    i0.ÉµÉµadvance(5);\n    i0.ÉµÉµtextInterpolate1(\" $\", i0.ÉµÉµpipeBind2(65, 13, ctx_r5.getOrderSubtotal(ctx_r5.detailOrder), \"1.2-2\"), \"\");\n    i0.ÉµÉµadvance(5);\n    i0.ÉµÉµtextInterpolate1(\" $\", i0.ÉµÉµpipeBind2(70, 16, ctx_r5.getOrderIVA(ctx_r5.detailOrder), \"1.2-2\"), \"\");\n    i0.ÉµÉµadvance(5);\n    i0.ÉµÉµtextInterpolate1(\" $\", i0.ÉµÉµpipeBind2(75, 19, ctx_r5.getOrderTotal(ctx_r5.detailOrder), \"1.2-2\"), \"\");\n  }\n}\nexport let OrdersComponent = /*#__PURE__*/(() => {\n  class OrdersComponent {\n    constructor(orderSvc, customerSvc, productSvc) {\n      this.orderSvc = orderSvc;\n      this.customerSvc = customerSvc;\n      this.productSvc = productSvc;\n      this.orders = [];\n      this.customers = [];\n      this.products = [];\n      this.loading = false;\n      this.error = \"\";\n      this.success = \"\";\n      this.searchText = \"\";\n      this.filteredOrders = [];\n      // filtro por cliente (id del cliente)\n      this.selectedCustomerFilter = \"\";\n      // expansiÃ³n de detalles\n      this.expandedOrderId = null;\n      // modal ediciÃ³n\n      this.showEditModal = false;\n      this.editOrder = null;\n      this.editShipAddress = \"\";\n      this.editShipCity = \"\";\n      this.editShipCountry = \"\";\n      this.editShipPostalCode = \"\";\n      // modal detalle\n      this.showDetailModal = false;\n      this.detailOrder = null;\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        yield _this.loadCustomersAndProducts();\n        yield _this.loadOrders();\n        _this.filteredOrders = [..._this.orders];\n      })();\n    }\n    loadCustomersAndProducts() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const [customers, products] = yield Promise.all([_this2.customerSvc.getCustomers(), _this2.productSvc.getProducts()]);\n          _this2.customers = customers || [];\n          _this2.products = products || [];\n          console.log(\"ðŸŸ¦ Clientes cargados en Orders:\", _this2.customers);\n        } catch (err) {\n          console.error(\"Error cargando clientes/productos:\", err);\n        }\n      })();\n    }\n    loadOrders() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        _this3.loading = true;\n        _this3.error = \"\";\n        _this3.success = \"\";\n        try {\n          let data;\n          if (_this3.selectedCustomerFilter) {\n            data = yield _this3.orderSvc.getOrdersByCustomer(_this3.selectedCustomerFilter);\n          } else {\n            data = yield _this3.orderSvc.getOrders();\n          }\n          _this3.orders = data || [];\n          _this3.applySearchFilter();\n        } catch (err) {\n          console.error(\"Error cargando Ã³rdenes:\", err);\n          _this3.error = \"No se pudieron cargar las Ã³rdenes.\";\n        } finally {\n          _this3.loading = false;\n        }\n      })();\n    }\n    // ================= Filtros / helpers =================\n    onFilterChange() {\n      this.loadOrders();\n    }\n    /** Buscar cliente por id */\n    findCustomerById(customerId) {\n      return this.customers.find(c => c.id === customerId);\n    }\n    /** Nombre completo del cliente usando firstName + lastName */\n    getCustomerName(order) {\n      if (!order) return \"\";\n      const c = this.findCustomerById(order.customerId);\n      if (!c) return order.customerId;\n      const fullName = `${c.firstName || \"\"} ${c.lastName || \"\"}`.trim();\n      if (fullName) return fullName;\n      if (c.cedula) return c.cedula;\n      return order.customerId;\n    }\n    /** CÃ©dula del cliente */\n    getCustomerCedula(order) {\n      if (!order) return \"\";\n      const c = this.findCustomerById(order.customerId);\n      return c?.cedula || \"\";\n    }\n    /** Email del cliente */\n    getCustomerEmail(order) {\n      if (!order) return \"\";\n      const c = this.findCustomerById(order.customerId);\n      return c?.email || \"\";\n    }\n    /** TelÃ©fono del cliente */\n    getCustomerPhone(order) {\n      if (!order) return \"\";\n      const c = this.findCustomerById(order.customerId);\n      return c?.phoneNumber || \"\";\n    }\n    /** Etiqueta para el combo de filtro de clientes */\n    getCustomerLabel(c) {\n      const fullName = `${c.firstName || \"\"} ${c.lastName || \"\"}`.trim();\n      if (fullName && c.cedula) return `${fullName} - ${c.cedula}`;\n      return fullName || c.cedula || c.id;\n    }\n    getProductName(productId) {\n      const p = this.products.find(x => x.id === productId);\n      return p ? p.name : `Producto #${productId}`;\n    }\n    applySearchFilter() {\n      const text = this.searchText.toLowerCase().trim();\n      if (!text) {\n        this.filteredOrders = [...this.orders];\n        return;\n      }\n      this.filteredOrders = this.orders.filter(order => {\n        const customer = this.getCustomerName(order).toLowerCase();\n        const orderId = String(order.id).toLowerCase();\n        const date = new Date(order.orderDate).toLocaleDateString().toLowerCase();\n        const shipAddress = `${order.shipAddress} ${order.shipCity} ${order.shipCountry}`.toLowerCase();\n        // Buscar dentro del detalle\n        const productsText = (order.orderDetails || []).map(d => this.getProductName(d.productId)).join(\" \").toLowerCase();\n        return customer.includes(text) || orderId.includes(text) || date.includes(text) || shipAddress.includes(text) || productsText.includes(text);\n      });\n    }\n    getOrderSubtotal(order) {\n      return (order.orderDetails || []).reduce((acc, d) => acc + (d.unitPrice || 0) * (d.quantity || 0), 0);\n    }\n    getOrderIVA(order) {\n      return this.getOrderSubtotal(order) * 0.15;\n    }\n    getOrderTotal(order) {\n      return this.getOrderSubtotal(order) + this.getOrderIVA(order);\n    }\n    toggleDetails(orderId) {\n      this.expandedOrderId = this.expandedOrderId === orderId ? null : orderId;\n    }\n    // ====== EdiciÃ³n ======\n    openEdit(order) {\n      this.editOrder = order;\n      this.editShipAddress = order.shipAddress;\n      this.editShipCity = order.shipCity;\n      this.editShipCountry = order.shipCountry;\n      this.editShipPostalCode = order.shipPostalCode;\n      this.showEditModal = true;\n      this.error = \"\";\n      this.success = \"\";\n    }\n    closeEditModal() {\n      this.showEditModal = false;\n      this.editOrder = null;\n    }\n    saveEdit() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        if (!_this4.editOrder) return;\n        if (!_this4.editShipAddress || !_this4.editShipCity || !_this4.editShipCountry || !_this4.editShipPostalCode) {\n          _this4.error = \"Complete todos los campos de envÃ­o.\";\n          return;\n        }\n        const payload = {\n          customerId: _this4.editOrder.customerId,\n          shipAddress: _this4.editShipAddress,\n          shipCity: _this4.editShipCity,\n          shipCountry: _this4.editShipCountry,\n          shipPostalCode: _this4.editShipPostalCode\n        };\n        try {\n          yield _this4.orderSvc.updateOrder(_this4.editOrder.id, payload);\n          _this4.success = \"Orden actualizada correctamente.\";\n          // actualizamos en memoria\n          _this4.editOrder.shipAddress = _this4.editShipAddress;\n          _this4.editOrder.shipCity = _this4.editShipCity;\n          _this4.editOrder.shipCountry = _this4.editShipCountry;\n          _this4.editOrder.shipPostalCode = _this4.editShipPostalCode;\n          _this4.closeEditModal();\n        } catch (err) {\n          console.error(\"Error al actualizar orden:\", err);\n          _this4.error = \"No se pudo actualizar la orden.\";\n        }\n      })();\n    }\n    // ====== Eliminar ======\n    deleteOrder(order) {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        const ok = confirm(`Â¿Eliminar la orden #${order.id}?`);\n        if (!ok) return;\n        try {\n          yield _this5.orderSvc.deleteOrder(order.id);\n          _this5.success = \"Orden eliminada correctamente.\";\n          _this5.orders = _this5.orders.filter(o => o.id !== order.id);\n          _this5.applySearchFilter();\n        } catch (err) {\n          console.error(\"Error al eliminar orden:\", err);\n          _this5.error = \"No se pudo eliminar la orden.\";\n        }\n      })();\n    }\n    // ====== DESCARGAR PDF ======\n    downloadPdf(order) {\n      this.error = \"\";\n      this.success = \"\";\n      this.generateInvoicePdf(order);\n    }\n    generateInvoicePdf(order) {\n      const doc = new jsPDF(\"p\", \"mm\", \"a4\");\n      const fecha = new Date(order.orderDate || new Date()).toLocaleString();\n      const customerName = this.getCustomerName(order);\n      const cedula = this.getCustomerCedula(order);\n      const email = this.getCustomerEmail(order);\n      const phone = this.getCustomerPhone(order);\n      // ===== ENCABEZADO AZUL =====\n      doc.setFillColor(35, 111, 162);\n      doc.rect(0, 0, 210, 40, \"F\");\n      doc.setTextColor(255, 255, 255);\n      doc.setFontSize(20);\n      doc.text(\"NorthWind Admin\", 14, 18);\n      doc.setFontSize(14);\n      doc.text(\"Factura de Venta\", 14, 30);\n      doc.setFontSize(10);\n      doc.text(\"RUC: 9999999999001\", 150, 14);\n      doc.text(\"Tel: +593 99 999 9999\", 150, 20);\n      doc.text(\"Email: ventas@northwind.com\", 150, 26);\n      // ===== CUADRO FACTURA & CLIENTE =====\n      doc.setTextColor(0, 0, 0);\n      doc.setFontSize(11);\n      doc.roundedRect(10, 45, 90, 30, 2, 2);\n      doc.text(`Factura NÂ°: ${order.id}`, 14, 55);\n      doc.text(`Fecha: ${fecha}`, 14, 62);\n      // aumentamos altura para mÃ¡s datos\n      doc.roundedRect(110, 45, 90, 45, 2, 2);\n      let yClient = 52;\n      doc.text(`Cliente: ${customerName}`, 114, yClient);\n      if (cedula) {\n        yClient += 7;\n        doc.text(`CÃ©dula: ${cedula}`, 114, yClient);\n      }\n      if (email) {\n        yClient += 7;\n        doc.text(`Email: ${email}`, 114, yClient);\n      }\n      if (phone) {\n        yClient += 7;\n        doc.text(`TelÃ©fono: ${phone}`, 114, yClient);\n      }\n      // ===== DATOS DE ENVÃO =====\n      doc.setFontSize(11);\n      doc.text(\"Datos de envÃ­o\", 14, 95);\n      doc.setFontSize(10);\n      let yInfo = 100;\n      doc.text(`DirecciÃ³n: ${order.shipAddress || \"-\"}`, 14, yInfo);\n      doc.text(`Ciudad: ${order.shipCity || \"-\"}`, 14, yInfo + 6);\n      doc.text(`PaÃ­s: ${order.shipCountry || \"-\"}`, 14, yInfo + 12);\n      doc.text(`CÃ³digo Postal: ${order.shipPostalCode || \"-\"}`, 14, yInfo + 18);\n      // ===== TABLA DETALLE =====\n      const details = order.orderDetails || [];\n      const body = details.map(d => {\n        const name = this.getProductName(d.productId);\n        const subtotal = (d.unitPrice || 0) * (d.quantity || 0);\n        return [name, d.quantity, `$${(d.unitPrice || 0).toFixed(2)}`, `$${subtotal.toFixed(2)}`];\n      });\n      autoTable(doc, {\n        startY: 125,\n        head: [[\"Producto\", \"Cant.\", \"Precio Unit.\", \"Subtotal\"]],\n        body,\n        styles: {\n          fontSize: 10\n        },\n        headStyles: {\n          fillColor: [35, 111, 162],\n          textColor: 255\n        }\n      });\n      // ===== TOTALES =====\n      const subtotal = this.getOrderSubtotal(order);\n      const iva = this.getOrderIVA(order);\n      const total = this.getOrderTotal(order);\n      const finalY = doc.lastAutoTable?.finalY || 140;\n      doc.setFontSize(11);\n      doc.text(\"Resumen\", 140, finalY + 4);\n      doc.setFontSize(10);\n      doc.text(`Subtotal:  $${subtotal.toFixed(2)}`, 140, finalY + 10);\n      doc.text(`IVA 15%:  $${iva.toFixed(2)}`, 140, finalY + 16);\n      doc.setFontSize(11);\n      doc.text(`Total:  $${total.toFixed(2)}`, 140, finalY + 24);\n      doc.setFontSize(10);\n      doc.text(\"Â¡Gracias por su compra!\", 14, finalY + 24);\n      doc.save(`factura_orden_${order.id}.pdf`);\n    }\n    // ====== Modal ver detalle ======\n    openDetail(order) {\n      this.detailOrder = order;\n      this.showDetailModal = true;\n    }\n    closeDetailModal() {\n      this.showDetailModal = false;\n      this.detailOrder = null;\n    }\n    static {\n      this.Éµfac = function OrdersComponent_Factory(t) {\n        return new (t || OrdersComponent)(i0.ÉµÉµdirectiveInject(i1.OrderService), i0.ÉµÉµdirectiveInject(i2.CustomerService), i0.ÉµÉµdirectiveInject(i3.ProductService));\n      };\n    }\n    static {\n      this.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n        type: OrdersComponent,\n        selectors: [[\"app-orders\"]],\n        decls: 18,\n        vars: 8,\n        consts: [[1, \"orders-container\"], [\"class\", \"alert alert-error\", 4, \"ngIf\"], [\"class\", \"alert alert-success\", 4, \"ngIf\"], [1, \"search-box\"], [\"type\", \"text\", \"placeholder\", \"Buscar por ID, cliente, fecha, producto, ciudad...\", 3, \"ngModel\", \"ngModelChange\", \"input\"], [1, \"fa-solid\", \"fa-magnifying-glass\", \"search-icon\"], [1, \"filter-box\"], [3, \"ngModel\", \"ngModelChange\", \"change\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"orders-table\", 4, \"ngIf\"], [4, \"ngIf\"], [\"class\", \"modal-backdrop\", 4, \"ngIf\"], [1, \"alert\", \"alert-error\"], [1, \"alert\", \"alert-success\"], [3, \"value\"], [1, \"orders-table\"], [1, \"actions-col\"], [4, \"ngFor\", \"ngForOf\"], [\"title\", \"Ver Detalles\", 1, \"icon-btn\", \"view\", 3, \"click\"], [1, \"fa-solid\", \"fa-eye\"], [\"title\", \"Editar Orden\", 1, \"icon-btn\", \"edit\", 3, \"click\"], [1, \"fa-solid\", \"fa-pen-to-square\"], [\"title\", \"Descargar PDF\", 1, \"icon-btn\", \"pdf\", 3, \"click\"], [1, \"fa-solid\", \"fa-file-pdf\"], [\"title\", \"Eliminar Orden\", 1, \"icon-btn\", \"delete\", 3, \"click\"], [1, \"fa-solid\", \"fa-trash\"], [1, \"modal-backdrop\"], [1, \"modal-content\"], [1, \"close-btn\", 3, \"click\"], [1, \"fa-solid\", \"fa-xmark\"], [1, \"detail-section\"], [1, \"details-table\"], [1, \"totals-box\"], [1, \"modal-actions\"], [1, \"action-btn\", \"pdf-btn\", 3, \"click\"]],\n        template: function OrdersComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ÉµÉµelementStart(0, \"div\", 0)(1, \"h1\");\n            i0.ÉµÉµtext(2, \"\\u00D3rdenes de Venta\");\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµtemplate(3, OrdersComponent_div_3_Template, 2, 1, \"div\", 1);\n            i0.ÉµÉµtemplate(4, OrdersComponent_div_4_Template, 2, 1, \"div\", 2);\n            i0.ÉµÉµelementStart(5, \"div\", 3)(6, \"input\", 4);\n            i0.ÉµÉµlistener(\"ngModelChange\", function OrdersComponent_Template_input_ngModelChange_6_listener($event) {\n              return ctx.searchText = $event;\n            })(\"input\", function OrdersComponent_Template_input_input_6_listener() {\n              return ctx.applySearchFilter();\n            });\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµelement(7, \"i\", 5);\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµelementStart(8, \"div\", 6)(9, \"label\");\n            i0.ÉµÉµtext(10, \"Filtrar por cliente:\");\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµelementStart(11, \"select\", 7);\n            i0.ÉµÉµlistener(\"ngModelChange\", function OrdersComponent_Template_select_ngModelChange_11_listener($event) {\n              return ctx.selectedCustomerFilter = $event;\n            })(\"change\", function OrdersComponent_Template_select_change_11_listener() {\n              return ctx.onFilterChange();\n            });\n            i0.ÉµÉµelementStart(12, \"option\", 8);\n            i0.ÉµÉµtext(13, \"-- Todos --\");\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµtemplate(14, OrdersComponent_option_14_Template, 2, 2, \"option\", 9);\n            i0.ÉµÉµelementEnd()();\n            i0.ÉµÉµtemplate(15, OrdersComponent_table_15_Template, 17, 1, \"table\", 10);\n            i0.ÉµÉµtemplate(16, OrdersComponent_div_16_Template, 3, 0, \"div\", 11);\n            i0.ÉµÉµelementEnd();\n            i0.ÉµÉµtemplate(17, OrdersComponent_div_17_Template, 80, 22, \"div\", 12);\n          }\n          if (rf & 2) {\n            i0.ÉµÉµadvance(3);\n            i0.ÉµÉµproperty(\"ngIf\", ctx.error);\n            i0.ÉµÉµadvance(1);\n            i0.ÉµÉµproperty(\"ngIf\", ctx.success);\n            i0.ÉµÉµadvance(2);\n            i0.ÉµÉµproperty(\"ngModel\", ctx.searchText);\n            i0.ÉµÉµadvance(5);\n            i0.ÉµÉµproperty(\"ngModel\", ctx.selectedCustomerFilter);\n            i0.ÉµÉµadvance(3);\n            i0.ÉµÉµproperty(\"ngForOf\", ctx.customers);\n            i0.ÉµÉµadvance(1);\n            i0.ÉµÉµproperty(\"ngIf\", ctx.filteredOrders && ctx.filteredOrders.length);\n            i0.ÉµÉµadvance(1);\n            i0.ÉµÉµproperty(\"ngIf\", !ctx.filteredOrders.length && !ctx.loading);\n            i0.ÉµÉµadvance(1);\n            i0.ÉµÉµproperty(\"ngIf\", ctx.showDetailModal);\n          }\n        },\n        dependencies: [i4.NgForOf, i4.NgIf, i5.NgSelectOption, i5.ÉµNgSelectMultipleOption, i5.DefaultValueAccessor, i5.SelectControlValueAccessor, i5.NgControlStatus, i5.NgModel, i4.DecimalPipe, i4.CurrencyPipe, i4.DatePipe],\n        styles: [\".orders-container[_ngcontent-%COMP%]{width:100%}h1[_ngcontent-%COMP%]{color:#236fa2;margin-bottom:20px}.alert[_ngcontent-%COMP%]{padding:10px 15px;border-radius:6px;margin-bottom:15px}.alert-error[_ngcontent-%COMP%]{background:#fde2e2;color:#b81c1c}.alert-success[_ngcontent-%COMP%]{background:#dcf5e3;color:#0f6b2f}.filter-box[_ngcontent-%COMP%]{margin-bottom:20px;display:flex;gap:10px;align-items:center}.filter-box[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:6px 10px;border-radius:6px;border:1px solid #ccc}.orders-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.orders-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .orders-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e5e5e5;padding:10px;text-align:left}.orders-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f4f7fb}.actions-col[_ngcontent-%COMP%]{white-space:nowrap;text-align:center}.icon-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;font-size:1.1rem;margin:0 6px}.icon-btn.view[_ngcontent-%COMP%]{color:#236fa2}.icon-btn.edit[_ngcontent-%COMP%]{color:#3498db}.icon-btn.pdf[_ngcontent-%COMP%]{color:#e74c3c}.icon-btn.delete[_ngcontent-%COMP%]{color:#b91c1c}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:rgba(0,0,0,.55);display:flex;justify-content:center;align-items:center;padding:25px;z-index:9999}.modal-content[_ngcontent-%COMP%]{background:white;padding:30px;width:650px;max-height:90vh;overflow-y:auto;border-radius:10px;position:relative;animation:_ngcontent-%COMP%_fadeIn .3s ease}@keyframes _ngcontent-%COMP%_fadeIn{0%{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}.close-btn[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;background:none;border:none;font-size:1.4rem;cursor:pointer;color:#444}.detail-section[_ngcontent-%COMP%]{margin-bottom:25px}.detail-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#236fa2;border-bottom:1px solid #d0d0d0;padding-bottom:5px}.details-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;margin-top:12px}.details-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .details-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border:1px solid #e5e5e5;padding:8px;text-align:left}.details-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#eef4fa}.totals-box[_ngcontent-%COMP%]{margin-top:15px;font-size:1.1rem}.totals-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:6px 0}.modal-actions[_ngcontent-%COMP%]{margin-top:20px;text-align:right}.pdf-btn[_ngcontent-%COMP%]{background:#e74c3c;color:#fff;border:none;padding:10px 15px;border-radius:6px;cursor:pointer}.pdf-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:6px}.search-box[_ngcontent-%COMP%]{width:500px;max-width:100%;margin-bottom:20px;position:relative}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:10px 40px 10px 14px;font-size:1rem;border:1px solid #ccc;border-radius:8px}.search-box[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#236fa2;outline:none;box-shadow:0 0 4px #236fa24d}.search-icon[_ngcontent-%COMP%]{position:absolute;right:14px;top:10px;color:#666;font-size:1.2rem}\"]\n      });\n    }\n  }\n  return OrdersComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}