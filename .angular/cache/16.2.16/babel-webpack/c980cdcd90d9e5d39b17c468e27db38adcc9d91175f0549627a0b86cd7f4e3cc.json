{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/HP/Desktop/angular-app-actualizado/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = this && this.__metadata || function (k, v) {\n  if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar _a;\nimport { Component } from '@angular/core';\nimport { ProductService } from '../../services/product.service';\nexport let ProductsComponent = class ProductsComponent {\n  constructor(prodSvc) {\n    this.prodSvc = prodSvc;\n    this.productos = [];\n    this.loading = false;\n    this.error = '';\n    // modales\n    this.isCreateModalOpen = false;\n    this.isEditModalOpen = false;\n    this.isDeleteModalOpen = false;\n    this.isErrorModalOpen = false;\n    this.modalErrorText = '';\n    // creación\n    this.newProduct = {\n      name: '',\n      unitsInStock: 0,\n      unitPrice: 0\n    };\n    // edición\n    this.editProductId = null;\n    this.editProduct = {\n      name: '',\n      unitsInStock: 0,\n      unitPrice: 0\n    };\n    this.deleteTarget = null;\n  }\n  ngOnInit() {\n    this.loadProducts();\n  }\n  loadProducts() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      _this.loading = true;\n      try {\n        _this.productos = yield _this.prodSvc.getProducts();\n      } catch (e) {\n        _this.error = 'No se pudo cargar productos';\n      }\n      _this.loading = false;\n    })();\n  }\n  // ================= MODAL CREAR =================\n  openCreateModal() {\n    this.newProduct = {\n      name: '',\n      unitsInStock: 0,\n      unitPrice: 0\n    };\n    this.error = '';\n    this.isCreateModalOpen = true;\n  }\n  closeCreateModal() {\n    this.isCreateModalOpen = false;\n  }\n  // ================= CREAR PRODUCTO =================\n  createProduct() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.error = '';\n      // MAYÚSCULAS\n      _this2.newProduct.name = _this2.newProduct.name.toUpperCase();\n      // validación caracteres\n      const nameRegex = /^[A-Z0-9\\s'\\-]+$/;\n      if (!nameRegex.test(_this2.newProduct.name)) {\n        _this2.openErrorModal(\"El nombre solo puede contener letras, números, espacios, apostrofe (') y guion (-)\");\n        return;\n      }\n      // validación duplicado\n      const exists = _this2.productos.some(p => p.name.toUpperCase() === _this2.newProduct.name.toUpperCase());\n      if (exists) {\n        _this2.openErrorModal(\"Ya existe un producto con ese nombre.\");\n        return;\n      }\n      // stock válido\n      if (_this2.newProduct.unitsInStock <= 0) {\n        _this2.newProduct.unitsInStock = 0;\n        return;\n      }\n      // precio válido\n      if (_this2.newProduct.unitPrice <= 0) {\n        _this2.newProduct.unitPrice = 0;\n        return;\n      }\n      const payload = {\n        name: _this2.newProduct.name,\n        unitsInStock: Number(_this2.newProduct.unitsInStock),\n        unitPrice: Number(_this2.newProduct.unitPrice)\n      };\n      try {\n        yield _this2.prodSvc.createProduct(payload);\n        yield _this2.loadProducts();\n        _this2.closeCreateModal();\n      } catch {\n        _this2.openErrorModal(\"No se pudo crear el producto\");\n      }\n    })();\n  }\n  // ================= EDITAR =================\n  openEditModal(p) {\n    this.editProductId = p.id;\n    this.editProduct = {\n      name: p.name,\n      unitsInStock: p.unitsInStock,\n      unitPrice: p.unitPrice\n    };\n    this.error = '';\n    this.isEditModalOpen = true;\n  }\n  closeEditModal() {\n    this.isEditModalOpen = false;\n  }\n  updateProduct() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      if (!_this3.editProductId) return;\n      // MAYÚSCULAS\n      _this3.editProduct.name = _this3.editProduct.name.toUpperCase();\n      // caracteres válidos\n      const nameRegex = /^[A-Z0-9\\s'\\-]+$/;\n      if (!nameRegex.test(_this3.editProduct.name)) {\n        _this3.openErrorModal(\"El nombre solo puede contener letras, números, espacios, apostrofe (') y guion (-)\");\n        return;\n      }\n      // duplicado\n      const exists = _this3.productos.some(p => p.id !== _this3.editProductId && p.name.toUpperCase() === _this3.editProduct.name.toUpperCase());\n      if (exists) {\n        _this3.openErrorModal(\"Ya existe un producto con ese nombre.\");\n        return;\n      }\n      // stock y precio válidos\n      if (_this3.editProduct.unitsInStock <= 0) {\n        _this3.editProduct.unitsInStock = 0;\n        return;\n      }\n      if (_this3.editProduct.unitPrice <= 0) {\n        _this3.editProduct.unitPrice = 0;\n        return;\n      }\n      const payload = {\n        name: _this3.editProduct.name,\n        unitsInStock: Number(_this3.editProduct.unitsInStock),\n        unitPrice: Number(_this3.editProduct.unitPrice)\n      };\n      try {\n        yield _this3.prodSvc.updateProduct(_this3.editProductId, payload);\n        yield _this3.loadProducts();\n        _this3.closeEditModal();\n      } catch {\n        _this3.openErrorModal(\"No se pudo actualizar el producto\");\n      }\n    })();\n  }\n  // ================= ELIMINAR =================\n  deleteProduct(p) {\n    this.deleteTarget = p;\n    this.isDeleteModalOpen = true;\n  }\n  cancelDelete() {\n    this.isDeleteModalOpen = false;\n    this.deleteTarget = null;\n  }\n  confirmDelete() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        yield _this4.prodSvc.deleteProduct(_this4.deleteTarget.id);\n        yield _this4.loadProducts();\n      } catch {\n        _this4.openErrorModal(\"No se pudo eliminar el producto\");\n      }\n      _this4.isDeleteModalOpen = false;\n      _this4.deleteTarget = null;\n    })();\n  }\n  // ================ MODAL DE ERROR ================\n  openErrorModal(msg) {\n    this.modalErrorText = msg;\n    this.isErrorModalOpen = true;\n  }\n  closeErrorModal() {\n    this.isErrorModalOpen = false;\n  }\n};\nProductsComponent = __decorate([Component({\n  selector: 'app-products',\n  templateUrl: './products.component.html',\n  styleUrls: ['./products.component.css']\n}), __metadata(\"design:paramtypes\", [typeof (_a = typeof ProductService !== \"undefined\" && ProductService) === \"function\" ? _a : Object])], ProductsComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}